\chapter{相似标准形：复数域上的尝试与理论}

\section{对角矩阵}
% 可对角化和数域无关
\subsection{可对角化的条件}

在介绍完相似的概念和基本性质后，我们便可以讨论如何寻找一组基使得线性变换的矩阵表示是一个很简单的矩阵，即寻找合适的相似标准形. 我们从复数域开始，因为在上一讲\autoref{thm:复数域上的特征值} 我们提到了复数域上的线性变换或矩阵必有特征值，并且根据\nameref{thm:代数学基本定理}可知特征值重数之和必定等于线性空间的维数（本讲在复数域下讨论，因此都承认这一点），而实数域则不一定，而特征值保证了一维不变子空间的存在，有很好的性质，因此我们可以先从复数域开始尝试. 并且我们就可以从一维不变子空间入手，因为\autoref{thm:不变子空间与分块对角矩阵} 告诉我们，如果线性空间$V$能分解为$\sigma\in\mathcal{L}(V)$的一维不变子空间的直和，那么每个分块都是大小为1的分块，那么矩阵将会是对角矩阵——这是我们能想到的最简单的矩阵之一了. 我们将这一定理严谨陈述如下：
\begin{theorem}{}{对角矩阵等价一维不变子空间}
    $n$维线性空间$V$上的线性变换$\sigma\in\mathcal{L}(V)$在基$B=\{\alpha_1,\ldots,\alpha_n\}$下的表示矩阵为对角矩阵$\diag(d_1,\ldots,d_n)$，当且仅当$V$能分解为$\sigma$的一维不变子空间的直和，即$V=U_1\oplus\cdots\oplus U_n$，其中$U_i=\spa(\alpha_i),\enspace i=1,\ldots,n$是$\sigma$的一维不变子空间.
\end{theorem}
\begin{proof}
    必要性我们直接写出线性映射矩阵表示的定义即可：
    \[\sigma(\alpha_1,\ldots,\alpha_n)=(\alpha_1,\ldots,\alpha_n)\begin{pmatrix}
            d_1 &        &     \\
                & \ddots &     \\
                &        & d_n
        \end{pmatrix},\]
    展开可得$\sigma(\alpha_i)=d_i\alpha_i$，故$\alpha_i$是$\sigma$的特征向量，$U_i=\spa(\alpha_i)$是$\sigma$的一维不变子空间，并且由于$\alpha_1,\ldots,\alpha_n$是一组基，因此$U_1\oplus\cdots\oplus U_n=V$. 反之直接将上述过程逆回即可写出对角化的矩阵表示.
\end{proof}

在上述定理中，线性变换在一组基下矩阵表示为对角矩阵，这样的线性变换我们称其为可对角化的，我们将这一定义严谨写下：
\begin{definition}{}{}
    设$\sigma\in\mathcal{L}(V)$，如果存在$V$的一组基使得$\sigma$在这组基下的矩阵是对角矩阵，则称$\sigma$可对角化.
\end{definition}

在上述定理的证明中我们可以直接观察到，如果一个线性变换可对角化，那么对应于对角矩阵的基中每一个向量必然是特征向量，因此我们很容易想到可对角化的下一个等价条件就是线性变换有一组由特征向量构成的基. 当然这只是一个观察，基于这一观察我们可以进一步扩展，得到下面这一关于线性变换可对角化等价条件的核心定理：
\begin{theorem}{}{可对角化条件}
    设$V$是数域$\mathbf{F}$上的$n$维线性空间，$\sigma$是$V$上的线性变换，$\lambda_1,\lambda_2,\ldots,\lambda_s\in\mathbf{F}$是$\sigma$的所有互异特征值，则以下条件等价：
    \begin{enumerate}
        \item \label{item:16:可对角化条件:1}
              $\sigma$可对角化；

        \item \label{item:16:可对角化条件:2}
              $\sigma$有$n$个线性无关的特征向量，它们构成$V$的一组基；

        \item \label{item:16:可对角化条件:3}
              $V$有在$\sigma$下不变的一维子空间$U_1,\ldots,U_n$，使得$V=U_1\oplus\cdots\oplus U_n$.

        \item \label{item:16:可对角化条件:4}
              $V=V_{\lambda_1}\oplus V_{\lambda_2}\oplus\cdots\oplus V_{\lambda_s}$；

        \item \label{item:16:可对角化条件:5}
              $n=\dim V_{\lambda_1}+\dim V_{\lambda_2}+\cdots+\dim V_{\lambda_s}$；

        \item \label{item:16:可对角化条件:6}
              $\sigma$每个特征值的代数重数等于几何重数.
    \end{enumerate}
\end{theorem}

\begin{proof}
    \begin{itemize}
        \item[\ref*{item:16:可对角化条件:1}$\implies$\ref*{item:16:可对角化条件:2}] 根据我们在推导求解线性变换对角矩阵流程时的分析，这一结论是成立的；

        \item[\ref*{item:16:可对角化条件:2}$\implies$\ref*{item:16:可对角化条件:3}] 由于$\sigma$有$n$个线性无关的特征向量，记为$\alpha_1,\ldots,\alpha_n$，则令$U_i=\spa(\alpha_i)$，则$U_i$是$\sigma$的不变子空间（因为$\sigma(\alpha_i)=\lambda\alpha_i\in U_i,\enspace\forall\alpha_i\in U_i$），且$V=U_1\oplus\cdots\oplus U_n$；

        \item[\ref*{item:16:可对角化条件:3}$\implies$\ref*{item:16:可对角化条件:4}] 我们将这些$U_i$中包含的向量按属于哪个$\lambda_i$的特征向量进行分类，然后每一类内的$U_i$进行直和即可得到特征子空间. 根据\autoref{thm:多空间直和} 可知结论成立；

        \item[\ref*{item:16:可对角化条件:4}$\implies$\ref*{item:16:可对角化条件:5}] 根据\hyperref[thm:直和等价命题]{直和的维数公式}显然成立；

        \item[\ref*{item:16:可对角化条件:5}$\implies$\ref*{item:16:可对角化条件:6}] 设$\lambda_1,\ldots,\lambda_s$的代数重数为$r_1,\ldots,r_s$，则$n=r_1+\cdots+r_s$，又根据\autoref{thm:代数重数与几何重数}，$\dim V_{\lambda_i}\leqslant r_i,\enspace i=1,\ldots,s$，因此由$n=\dim V_{\lambda_1}+\cdots+\dim V_{\lambda_s}$可知必须有$\dim V_{\lambda_i}=r_i,\enspace i=1,\ldots,s$，即每个特征值的代数重数等于几何重数；

        \item[\ref*{item:16:可对角化条件:6}$\implies$\ref*{item:16:可对角化条件:1}] 由于每个特征值的代数重数等于几何重数，因此特征子空间维数之和为$n$，故存在$n$个线性无关的特征向量，根据我们在推导求解线性变换对角矩阵流程时的分析，这表明$\sigma$可对角化.
    \end{itemize}
\end{proof}

我们有一个显然的推论如下：
\begin{corollary}{}{可对角化必要条件}
    若$n$维空间上的线性变换$\sigma$有$n$个不同的特征值，则$\sigma$可对角化. 反之，$\sigma$可对角化不一定有$n$个特征值.
\end{corollary}

\begin{proof}
    若$n$维空间上的线性变换$\sigma$有$n$个不同的特征值$\lambda_1,\ldots,\lambda_n$，设$v_1,\ldots,v_n$分别是$\lambda_1,\ldots,\lambda_n$对应的特征向量，由于$v_1,\ldots,v_n$线性无关，因此$v_1,\ldots,v_n$构成$V$的一组基，故$\sigma$可对角化.

    反之，我们只需要举出最简单的反例，例如$\sigma=I_V$，即$V$上的恒等映射，它的特征值只有一个，即$\lambda=1$，但它可对角化（因为在任意一组基下的矩阵都是单位矩阵）.
\end{proof}

我们知道线性变换在不同基下的表示矩阵是相似的，因此我们完全可以将可对角化的概念推广到矩阵上：
\begin{definition}{}{}
    设$A\in\mathbf{F}^{n\times n}$，如果存在可逆矩阵$P$使得$P^{-1}AP$是对角矩阵，则称$A$可对角化（等价于$A$相似于对角矩阵）.
\end{definition}
显然的，矩阵的可对角化与线性变换可对角化之间的关联是密不可分的. 因为如果线性变换$\sigma$可对角化，则它的任意一组基$B_1$下的表示矩阵$A$都是可对角化的. 原因在于$\sigma$在某组基$B_2$下的矩阵是对角矩阵$\varLambda$，因此$A$和$\varLambda$是$\sigma$在两组基下的表示矩阵，因此$A$相似于对角矩阵，故$A$可对角化. 反之亦然，若$\sigma$的任意一组基下的表示矩阵$A$可对角化，这说明$A$相似于对角矩阵，因此$\sigma$在某一组基下的矩阵是对角矩阵，因此$\sigma$可对角化.

我们很多时候会直接讨论矩阵的可对角化，因此自然的，我们希望得到矩阵可对角化的等价条件. 只需回顾矩阵和线性变换特征值与特征向量的对应关系（特征值一致，特征向量有坐标的关系），我们可以将以上线性变换可对角化的结果都推广到矩阵的可对角化上（除矩阵我们没有讨论不变子空间外）：
\begin{theorem}{}{}
    设$A$是数域$\mathbf{F}$上的$n$阶矩阵，$\lambda_1,\lambda_2,\ldots,\lambda_s\in\mathbf{F}$是$A$的所有互异特征值，则以下条件等价：
    \begin{enumerate}
        \item $A$可对角化；
        \item $A$有$n$个线性无关的特征向量，它们构成$\mathbf{F}^n$的一组基；
        \item $n=\dim V_{\lambda_1}+\dim V_{\lambda_2}+\cdots+\dim V_{\lambda_s}$；
        \item $A$每个特征值的代数重数等于几何重数.
    \end{enumerate}
\end{theorem}

\begin{corollary}{}{}
    若$n$阶矩阵$A$有$n$个不同的特征值，则$A$可对角化. 反之，$A$可对角化不一定有$n$个特征值.
\end{corollary}

实际上由特征值的性质，我们容易知道数域$\mathbf{F}$上矩阵$A$（或$\sigma\in\mathcal{L}(V)$）可对角化，对于数域$\mathbf{F}$上任意多项式$f(x)$，$f(A)$（或$f(\sigma)$）也可对角化，且$A$（或$\sigma$）可逆时，$A^{-1}$（或$A^{-1}$）和$A^*$也可对角化（我们只证明矩阵版本，线性映射完全一致，除了没有定义伴随矩阵对应的线性映射）：

\begin{proof}
    根据我们对特征值性质的讨论，若$A$有特征值$\lambda$，则$f(A)$对应的特征值为$f(\lambda)$，且$A$可逆时，$A^{-1}$和$A^*$有特征值$\lambda^{-1}$和$|A|\lambda^{-1}$，并且相应的特征向量保持不变，因此特征子空间都不变，一定也能保证特征子空间直和为$V$，因此它们都可对角化.
\end{proof}

得到了可对角化的等价条件后，我们自然有一个美好的愿景：如果每个线性变换和矩阵都是可对角化的，那么我们关于相似标准形的讨论似乎就可以结束了——对角化很显然是个能令人满意的结局！然而事与愿违，并非所有的线性变换和矩阵都是可对角化的，如下面的例子：
\begin{example}{}{若当块不可对角化}
    证明$r$阶上三角矩阵$(r>1)$
    \[J_0=\begin{pmatrix}
            \lambda_0 & 1         &        &           \\
                      & \lambda_0 & \ddots &           \\
                      &           & \ddots & 1         \\
                      &           &        & \lambda_0
        \end{pmatrix}\]
    不与对角阵相似.
\end{example}

\begin{solution}
    首先求出特征多项式为 $f(\lambda) = |\lambda E - J_0| = (\lambda - \lambda_0)^r$，因此 $J_0$ 只有一个特征值 $\lambda_0$，且代数重数为 $r$.
    
    接下来求几何重数，即 $J_0X = \lambda_0X$ 的解空间维数，即 $(\lambda_0 E - J_0)X = 0$的解空间维数，事实上由于 $r(\lambda_0 E - J_0) = r - 1$，因此解空间维数为 $r - (r - 1) = 1$，即几何重数为 $1 < r$，因此不可对角化.
\end{solution}

事实上，上例中的矩阵我们称之为若当块矩阵，我们未来将会有完整的一讲来介绍这一类型矩阵，因为它在我们的讨论中具有非常重要的地位——不可对角化的线性变换能得到的最简单的矩阵表示就是由多个若当块矩阵构成的，因此得到这一矩阵形式将是我们未来讨论的一大目标，这也同时宣告了将对角化作为终极目标的失败.

\subsection{对角化问题的一般解法}

在得到线性变换和矩阵可对角化的充要条件后，我们关心如何求解一个可对角化的线性变换和矩阵对应的对角矩阵，以及解出
\begin{enumerate}
    \item $\sigma$ 在何组基下的矩阵是对角矩阵；

    \item 什么样的矩阵 $P$ 使得 $P^{-1}AP$ 是对角矩阵.
\end{enumerate}

我们将分别进行讨论. 我们先讨论矩阵的情况. 我们已知$A$可对角化，那么存在可逆矩阵$P$使得$P^{-1}AP$是对角矩阵. 为了求解出$P$，将$P^{-1}AP=\varLambda$变形为$AP=P\varLambda$，并将矩阵$P$按列分块为$P=(X_1,X_2,\ldots,X_n)$，则有
\[A(X_1,X_2,\ldots,X_n)=(X_1,X_2,\ldots,X_n)\diag(\lambda_1,\lambda_2,\ldots,\lambda_n),\]
利用分块矩阵乘法我们有$AX_j=\lambda_jX_j\enspace(X_j\neq 0,\enspace j=1,2,\ldots,n)$. 由于$P$是可逆矩阵，因此其列向量必然构成$\mathbf{F}^n$的一组基，这与$A$可对角化当且仅当$A$有$n$个线性无关的特征向量是一致的，并且这些线性无关的特征向量按列排列就是我们要求解的$P$.

对于线性变换我们也可以做类似的分析. 事实上，若$\sigma$可对角化，我们可以简要做以下分析. 设$\sigma$在$V$的一组基$\alpha_1,\ldots,\alpha_n$下的矩阵为对角矩阵$\varLambda=\diag(\lambda_1,\ldots,\lambda_n)$，由线性映射矩阵表示的定义，这等价于
\[\sigma(\alpha_i)=\lambda_i\alpha_i\enspace(i=1,\ldots,n),\]
即$\alpha_1,\ldots,\alpha_n$是$\sigma$的$n$个线性无关的特征向量，并且这$n$个特征向量就是使得$\sigma$矩阵表示为对角矩阵的那组基，于是只需求出$n$个线性无关的特征向量即可完成对角化任务，然而，我们会遇到上一讲中提到的问题，即没有程序化的方法求解线性变换的特征值和特征向量. 但我们知道线性变换$\sigma$与其在任意一组基$B$下的矩阵$A$有相同的特征值，且$A$的特征向量是$\sigma$特征向量在$B$下的坐标. 因此我们可以``曲线救国''，得到求解线性变换的对角化问题的一般流程如下：

\begin{enumerate}
    \item 先任意写出$\sigma$在一组基$B$下的矩阵$A$，当然为了计算方便一般选取自然基；

    \item 利用特征多项式$f(\lambda)=|\lambda E-A|=0$求出$A$的所有不同特征值；

    \item 解线性方程组$AX=\lambda X$（实际上就是方程组$(\lambda E-A)X=0$，其中$\lambda$是上一步求出的特征值）求出$A$在不同特征值下的线性无关特征向量；

    \item 第三步中求得的所有向量就是$\sigma$的特征向量在基$B$下的坐标，根据前面的讨论，$\sigma$的特征向量也就是使得$\sigma$的矩阵表示为对角矩阵的那组基.

    \item 当然，如果题目中直接给出求$P$使得$P^{-1}AP$为对角矩阵，那么我们只需进行2、3两步，并将3中得到的向量按列排列成矩阵$P$即可.
\end{enumerate}

下面我们来看几个例子练习一下上面的求解过程：
\begin{example}{}{}
    求矩阵
    \[A=\begin{pmatrix}
            0  & -1 & 1 \\
            -1 & 0  & 1 \\
            1  & 1  & 0
        \end{pmatrix}\]
    的所有特征值，对应的特征子空间，以及与 $A$ 相似的一个对角矩阵.
\end{example}

\begin{solution}
    对于求解矩阵的对角化问题，首先求出其特征多项式（具体步骤不展开，实际上就是三阶行列式的计算，可以使用按行（列）展开、公式法或者初等变换化为三角矩阵等方法）$f(\lambda)=|\lambda E-A|=(\lambda-1)^2(\lambda+2)$，令$f(\lambda)=0$，解得特征值为 $\lambda_1=\lambda_2=1,\lambda_3=-2$.

    接下来求解特征向量和特征子空间，即求解$(E-A)x=0$和解$(-2E-A)x=0$，得到特征值1对应的特征子空间为$\spa((-1,1,0)^{\mathrm{T}},(1,0,1)^{\mathrm{T}})$，特征值-2对应的特征子空间为$\spa((-1,-1,1)^{\mathrm{T}})$.

    与$A$相似的对角矩阵实际上就是特征值排列在对角线上的结果，即 $\diag(1,1,-2)$.
\end{solution}

\begin{example}{}{}
    设 $T$ 是次数小于等于 2 的实多项式线性空间 $V$ 上的变换，对任意 $f(x) \in V$，定义
    \[T(f(x))=\frac{\mathrm{d}((x-2)f(x))}{\mathrm{d}x}\]
    证明 $T$ 是 $V$ 上的线性变换，且$T$可对角化.
\end{example}

\begin{proof}
    首先证明这是线性变换. 首先验证线性性，对于任意$f(x),g(x)\in V$，$a,b\in\mathbf{R}$，我们有
    \begin{align*}
        T(af(x)+bg(x)) & =\frac{\mathrm{d}((x-2)(af(x)+bg(x)))}{\mathrm{d}x}                                    \\
                       & =\frac{\mathrm{d}(axf(x)-2af(x)+bxg(x)-2bg(x))}{\mathrm{d}x}                           \\
                       & =a\frac{\mathrm{d}((x-2)f(x))}{\mathrm{d}x}+b\frac{\mathrm{d}((x-2)g(x))}{\mathrm{d}x} \\
                       & =aT(f(x))+bT(g(x)).
    \end{align*}
    然后说明这是$V$上的线性变换，即该映射的到达空间是$V$，即$T(f(x))\in V$， 因为$f(x)$是次数小于等于2的实多项式，设$f(x)=ax^2+bx+c$，则
    \begin{align*}
        T(f(x)) & =\frac{\mathrm{d}((x-2)(ax^2+bx+c))}{\mathrm{d}x}          \\
                & =\frac{\mathrm{d}(ax^3+(b-2a)x^2+(c-2b)x-2c)}{\mathrm{d}x} \\
                & =3ax^2+2(b-2a)x+(c-2b)\in V.
    \end{align*}
    因此$T$是$V$上的线性变换.

    下面我们来判断$T$是否可对角化. 线性变换的可对角化问题第一步要转化为任意一组基下的矩阵，然后判断矩阵是否可对角化，因此我们先任意选取一组基，为方便我们选取自然基$\{1,x,x^2\}$，然后求出$T$在这组基下的矩阵$A=\begin{pmatrix}
            1 & -2 & 0 \\ 0 & 2 & -4 \\ 0 & 0 & 3
        \end{pmatrix}$，然后求出其特征多项式$f(\lambda)=|\lambda E-A|=(\lambda-1)(\lambda-2)(\lambda-3)$，令$f(\lambda)=0$，解得特征值为 $\lambda_1=1,\lambda_2=2,\lambda_3=3$. 即该3阶矩阵有3个不同的特征值，因此由\autoref{cor:可对角化必要条件} 可知$A$可对角化，即$T$可对角化.
\end{proof}

除此之外，我们还可以利用对角化求解矩阵的幂的问题. 若一个矩阵$A$可对角化，即存在可逆矩阵$P$使得$A=P^{-1}\varLambda P$（其中$\varLambda$为对角矩阵），在这种形式下$A$的幂是很好求的，因为$A^k=P^{-1}\varLambda^kP$，$\varLambda$为对角矩阵，因此其幂是好求的. 我们来看一个例子
\begin{example}{}{}
    已知$A=\begin{pmatrix}
            0 & \dfrac{1}{2}  & \dfrac{1}{2} \\[2ex]
            1 & -\dfrac{1}{2} & \dfrac{1}{2} \\[2ex]
            1 & -\dfrac{1}{2} & \dfrac{1}{2}
        \end{pmatrix}$，求$A^n$.
\end{example}

\begin{solution}
    首先求出$A$的特征多项式$f(\lambda)=|\lambda E-A|=\lambda(\lambda-1)(\lambda+1)$，令$f(\lambda)=0$，解得特征值为 $\lambda_1=0,\lambda_2=1,\lambda_3=-1$.

    接下来求解特征向量和特征子空间，实际上就是求解$(0E-A)x=0,(-E-A)x=0,(E-A)x=0$，得到特征向量为
    \[\eta_1=\begin{pmatrix}
            1 \\ 1 \\ -1
        \end{pmatrix},\enspace \eta_2=\begin{pmatrix}
            1 \\ 1 \\ 1
        \end{pmatrix},\enspace \eta_3=\begin{pmatrix}
            1 \\ -1 \\ -1
        \end{pmatrix}.\]
    所以记$P=(\eta_1,\eta_2,\eta_3)$，则$A=P\diag(0,1,-1)P^{-1}$，因此
    \[A^n=P\diag(0^n,1^n,(-1)^n)P^{-1},\]
    进一步计算得到
    \[A^n=\frac{1}{2}\begin{pmatrix}
            1+(-1)^n     & (-1)^{n+1} & 1 \\
            1+(-1)^{n+1} & (-1)^n     & 1 \\
            1+(-1)^{n+1} & (-1)^n     & 1
        \end{pmatrix}.\]
\end{solution}

\subsection{可对角化的经典例子}

接下来我们将给出一些综合性的经典例子来运用上面的可对角化等价条件以及对角化过程：
\begin{example}{}{}
    线性变换 $T : \mathbf{R}^3 \to \mathbf{R}^3$ 的定义是：
    \[T(x_1,x_2,x_3)=(4x_1+x_3,2x_1+3x_2+2x_3,x_1+4x_3)\]
    \begin{enumerate}
        \item 求出$T$的特征多项式及特征值；

        \item 判断$T$是否可对角化，并给出理由.
    \end{enumerate}
\end{example}

\begin{solution}
    \begin{enumerate}
        \item 我们知道，线性变换与其在任意一组基下的矩阵有相同的特征值和特征多项式，因此我们可以任意选取一组基（为方便我们取$\mathbf{R}^3$的自然基，然后求出$T$在这组基下的矩阵，即
              \[A=\begin{pmatrix}
                      4 & 0 & 1 \\
                      2 & 3 & 2 \\
                      1 & 0 & 4
                  \end{pmatrix}\]
              故$T$的特征多项式为$f(\lambda)=|A-\lambda E|=\begin{vmatrix}
                      4-\lambda & 0         & 1         \\
                      2         & 3-\lambda & 2         \\
                      1         & 0         & 4-\lambda
                  \end{vmatrix}=-(\lambda-3)^2(\lambda-5)$，$T$的特征值为$f(\lambda)=0$的解，即为$\lambda_1=\lambda_2=3,\lambda_3=5$.

        \item 对于$\lambda=3$，我们求解$(T-3I)\alpha$得到特征向量（其中令$\alpha=(x_1,x_2,x_3)$），解得$\alpha_1=(1,0,-1)^\mathrm{T},\alpha_2=(0,1,0)^\mathrm{T}$，因此$T$在$\lambda=3$时的特征子空间为$V_3=\spa(\alpha_1,\alpha_2)$，维数为2，因此$\lambda=3$时代数重数与几何重数相等. 而$\lambda=5$是一重特征值，因此也必有代数重数与几何重数相等（因为一定有特征向量，那么特征子空间维数至少为1，再结合代数重数大于等于几何重数可知，特征子空间维数恰为1）. 因此$T$可对角化.
    \end{enumerate}
\end{solution}

\begin{example}{}{秩1矩阵可对角化}
    设$\alpha$和$\beta$是$\mathbf{R}^n\enspace (n>1)$中两个列向量，$A=\alpha\beta^\mathrm{T}\neq O$.
    \begin{enumerate}
        \item 求$A$的特征值；

        \item 证明：$\alpha^\mathrm{T}\beta=0\iff A$不可对角化.
    \end{enumerate}
\end{example}

\begin{solution}
    \begin{enumerate}
        \item 我们知道，$r(A)\leqslant\min{\{r(\alpha),r(\beta)\}}=1$，并且$A\neq O$因此$r(A)>0$，故$A$的秩为1. 而$n>1$，因此$A$一定不可逆，故0一定是$A$的特征值，且对应的特征子空间维数为$AX=0$的解空间维数，即为$n-1$.

              由此我们知道$A$最多有两个特征值，因为0的代数重数（即作为$n$次特征多项式的零点次数）必然大于等于其几何重数$n-1$，当期代数重数为$n-1$时可能还有一个一重特征值. 我们利用特征值之和等于$A$的迹来找出可能的第二个特征值. 我们设$\alpha=(a_1,a_2,\ldots,a_n)^\mathrm{T},\beta=(b_1,b_2,\ldots,b_n)^\mathrm{T}$，则$A=\alpha\beta^\mathrm{T}=\begin{pmatrix}
                      a_1b_1 & a_1b_2 & \cdots & a_1b_n \\
                      a_2b_1 & a_2b_2 & \cdots & a_2b_n \\
                      \vdots & \vdots & \ddots & \vdots \\
                      a_nb_1 & a_nb_2 & \cdots & a_nb_n
                  \end{pmatrix}$，因此$A$的迹为$\sum\limits_{i=1}^na_ib_i=\alpha^\mathrm{T}\beta=\sum\limits_{i=1}^n\lambda_i$，其中$\lambda_i$为$A$的特征值. 若$\alpha^\mathrm{T}\beta\neq 0$，则$\lambda_i=0,\enspace i=1,\ldots,n-1$，$\lambda_n=\alpha^\mathrm{T}\beta$. 若$\alpha^\mathrm{T}\beta=0$，则$A$的所有特征值均为0.

        \item 由上一小问可知，若$\alpha^\mathrm{T}\beta=0$即$A$的全部特征值为0，因此只有一个$n-1$维的特征子空间，故特征子空间直和不等于$V$，故不可对角化.

              反之，若$A$不可对角化，我们用反证法. 假设$\alpha^\mathrm{T}\beta\neq 0$，则$A$有两个特征值，一个为0，一个为$\alpha^\mathrm{T}\beta$，因此$A$有两个特征子空间，一个是0对应的$n-1$维特征子空间，一个是$\alpha^\mathrm{T}\beta$对应的一维特征子空间，因此$V$可分解为两个特征子空间的直和，与$A$不可对角化矛盾，因此$\alpha^\mathrm{T}\beta=0$.
    \end{enumerate}
\end{solution}

本例非常经典，请读者务必掌握本例的结论和解决方法. 事实上这一例题的结论与这一论述是等价的：秩为1的矩阵$A$可对角化的充要条件是$A$的迹不为0.

下面我们来看一些非常经典的可对角化问题，希望读者能够熟知：
\begin{example}{}{可对角化经典例题}
    解决以下关于可对角化的基本问题：
    \begin{enumerate}
        \item 设$A$为$n$阶矩阵，且$A^2=2A$. 证明：$A$可对角化，并求出与之相似的对角矩阵（注：本题结论可推广到任意的$A^2=kA$）；

        \item 设$A$为$n$阶非零矩阵，且$A^m=O\enspace(m\in\mathbf{N}_+,\enspace m>1)$. 证明：$A$不可对角化；

        \item 设$A$为二阶矩阵，非零向量$\alpha$不是$A$的特征向量，且$A^2\alpha-3A\alpha+2\alpha=0$. 证明：$\alpha$和$A\alpha$线性无关且$A$可对角化并求与$A$相似的对角矩阵.
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item 由题意$A^2-2A=O$，因此$A$的特征值$\lambda$满足\autoref{ex:特征值的性质} 第三问中提到的形式，因此$A$的特征值就是方程$\lambda^2-2\lambda=0$的解，即$\lambda_1=0,\lambda_2=2$.

              接下来我们需要说明0和2对应的特征子空间维数之和为$n$，即$\dim V_0+\dim V_2=n$，其中$V_0$和$V_2$分别为0和2对应的特征子空间. 事实上，由$A^2=2A$可知$A(A-2E)=O$，由\autoref{ex:线性方程组理论与秩不等式} 知$r(A)+r(A-2E)\leqslant n$，又根据秩不等式$r(A)+r(B)\geqslant r(A+B)$，因此$r(A)+r(A-2E)=r(A)+r(2E-A)\geqslant r(A+(2E-A))=r(2E)=n$. 综上可知，$r(A)+r(A-2E)=n$.

              实际上，$V_0$就是$AX=0$的解空间，$V_2$就是$(A-2E)X=0$的解空间，因此$\dim V_0=n-r(A),\dim V_2=n-r(A-2E)$，因此由$r(A)+r(A-2E)=n$可知$\dim V_0+\dim V_2=2n-n=n$，即0和2对应的特征子空间维数之和为$n$，因此$A$可对角化.

              由于可对角化矩阵代数重数等于几何重数，因此特征值0对应的代数重数为$n-r(A)$，特征值2对应的代数重数为$r(A)$，因此我们可以得到与$A$相似的对角矩阵为$\diag(0,\ldots,0,2,\ldots,2)$，其中0的个数为$n-r(A)$，2的个数为$r(A)$.

        \item 设$\lambda$是$A$的特征值，由题意$\lambda^m=0$，即$\lambda=0$，因此$A$的所有特征值都为0. 但$r(A)>0$（因为$A$不是零矩阵），因此0对应的特征子空间维数为$n-r(A)<n$，因此$A$不可对角化.

        \item 反证法，假设$\alpha$和$A\alpha$线性相关，则存在不全为零的常数$k_1,k_2$使得$k_1\alpha+k_2A\alpha=0$. 显然$k_2\neq 0$，因为假设$k_2=0$，则$k_1\alpha=0$，由于$\alpha\neq 0$，故$k_1=0$，这与$k_1,k_2$不全为0矛盾. 因此我们有$A\alpha=-\dfrac{k_1}{k_2}\alpha$，即$\alpha$是$A$的特征向量，这与题设矛盾，因此$\alpha$和$A\alpha$线性无关.

              由题意，$A^2\alpha-3A\alpha+2\alpha=0$，即$(A^2-3A+2E)\alpha=0$，又$\alpha\neq 0$，因此$A^2-3A+2E$不可逆，从而$|A^2-3A+2E|=|E-A||2E-A|=0$，故$|E-A|=0$或$|2E-A|=0$.

              若$|E-A|\neq 0$，则$E-A$可逆，因此$(A^2-3A+2E)\alpha=(E-A)((2E-A)\alpha)=0$可知$(2E-A)\alpha=0$，即$A\alpha=2\alpha$，故$\alpha$为$A$的特征向量，这与条件矛盾，因此$|E-A|=0$. 同理，$|2E-A|=0$，因此$A$有两个特征值1和2，又$A$是2阶矩阵，因此由\autoref{cor:可对角化必要条件} 可知$A$一定可对角化，且对角矩阵为$\begin{pmatrix}
                      1 & 0 \\
                      0 & 2
                  \end{pmatrix}$.
    \end{enumerate}
\end{proof}

最后需要说明一点，如果一个矩阵可对角化，则有$P^{-1}AP=\varLambda$，其中$\varLambda$是对角矩阵，$P$就是求解对角化问题过程中用到的由特征向量组成的矩阵. 那么我们可以将$A$表示为$A=P\varLambda P^{-1}$，这就是所谓特征值分解. 实际上之前相抵的讨论中我们也提到了类似的分解的技巧，它可以帮助我们解决很多问题. 事实上，之后学习的若当标准形、相合等都有类似的表示思想，在解决一些问题时是重要的.
\begin{example}{}{}
    设三阶矩阵$A$的特征值为$\lambda_1=-2,\lambda_2=1,\lambda_3=2$，对应的特征向量分别为$\alpha_1=(1,1,0)^\mathrm{T},\alpha_2=(1,0,1)^\mathrm{T},\alpha_3=(1,1,1)^\mathrm{T}$，求矩阵$A$.
\end{example}

\begin{solution}
    根据特征值分解可知，$A=P\varLambda P^{-1}$，其中$P=(\alpha_1,\alpha_2,\alpha_3),\varLambda=\begin{pmatrix}
            -2 & 0 & 0 \\
            0  & 1 & 0 \\
            0  & 0 & 2
        \end{pmatrix}$，因此
    \[A=P\varLambda P^{-1}=\begin{pmatrix}
            1 & 1 & 1 \\
            1 & 0 & 1 \\
            0 & 1 & 1
        \end{pmatrix}\begin{pmatrix}
            -2 & 0 & 0 \\
            0  & 1 & 0 \\
            0  & 0 & 2
        \end{pmatrix}\begin{pmatrix}
            1  & 0  & -1 \\
            1  & -1 & 0  \\
            -1 & 1  & 1
        \end{pmatrix}=\begin{pmatrix}
            -3 & 1 & 4 \\
            -4 & 2 & 4 \\
            -1 & 1 & 2
        \end{pmatrix}.\]
\end{solution}

\begin{example}{}{}
    设$A$相似于对角矩阵，$\lambda_0$是$A$的特征值，$X_0$是$A$对应于$\lambda_0$的特征向量，证明：
    \begin{enumerate}
        \item $r((A-\lambda_0 E)^2)=r(A-\lambda_0 E)$；

        \item 不存在$Y$使得$(A-\lambda_0 E)Y=X_0$.
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item 由已知，设$A$的$n$个特征值为$\lambda_0,\lambda_1,\ldots,\lambda_{n-1}$，故$A$相似于对角矩阵$\varLambda=\diag(\lambda_0,\lambda_1,\ldots,\lambda_{n-1})$，设$P^{-1}AP=\varLambda$，因此
              \[A-\lambda_0 E=P\varLambda P^{-1}-\lambda_0 PP^{-1}=P\diag(0,\lambda_1-\lambda_0,\ldots,\lambda_{n-1}-\lambda_0)P^{-1},\]
              从而
              \[(A-\lambda_0 E)^2=P\diag(0,(\lambda_1-\lambda_0)^2,\ldots,(\lambda_{n-1}-\lambda_0)^2)P^{-1},\]
              由于$\lambda_i-\lambda_0=0$的充要条件是$(\lambda_i-\lambda_0)^2=0$，所以
              \begin{align*}
                  r((A-\lambda_0 E)^2) & =r(P\diag(0,(\lambda_1-\lambda_0)^2,\ldots,(\lambda_{n-1}-\lambda_0)^2)P^{-1}) \\
                                       & =r(\diag(0,(\lambda_1-\lambda_0)^2,\ldots,(\lambda_{n-1}-\lambda_0)^2))        \\
                                       & =r(\diag(0,\lambda_1-\lambda_0,\ldots,\lambda_{n-1}-\lambda_0))                \\
                                       & =r(P\diag(0,\lambda_1-\lambda_0,\ldots,\lambda_{n-1}-\lambda_0)P^{-1})         \\
                                       & =r(A-\lambda_0 E).
              \end{align*}
              故命题得证.

        \item 反证法，假设存在$Y$使得$(A-\lambda_0 E)Y=X_0$，则$(A-\lambda_0 E)^2Y=(A-\lambda_0 E)X_0=0$（因为$X_0$是$A$对应于$\lambda_0$的特征向量）.

              由于$r((A-\lambda_0 E)^2)=r(A-\lambda_0 E)$，因此$(A-\lambda_0 E)^2X=0$与$(A-\lambda_0 E)X=0$的解空间维数相同，又$(A-\lambda_0 E)X=0$的解显然一定也是$(A-\lambda_0 E)^2X=0$的解，因此实际上两方程组同解（回顾$U$和$W$都是$V$的非零子空间，$U\subseteq W$，且$\dim U=\dim W$，则$U=W$）.

              由于$(A-\lambda_0 E)^2Y=0$，因此也有$(A-\lambda_0 E)Y=0$，但已知$(A-\lambda_0 E)Y=X_0\neq 0$，矛盾，因此不存在$Y$使得$(A-\lambda_0 E)Y=X_0$.
    \end{enumerate}
\end{proof}

事实上，在一般的教材中还会专门探讨实对称矩阵的对角化问题. 这一问题涉及到后续要讲解的正交概念，因此我们会在内积空间上的线性变换中通过谱定理讨论这一问题. 届时我们将讨论在内积空间中的线性变换满足什么条件时一定可以对角化.

\section{分块对角矩阵}

\subsection{核空间的性质}

我们仍然循着\autoref{thm:不变子空间与分块对角矩阵} 提供的范式寻找相似标准形，即我们的目标仍然是寻找线性空间的一个不变子空间分解。我们知道线性变换不可对角化实际上是因为它没有足够多的线性无关的特征向量，也即特征子空间直和后比原空间略小，因此基于特征子空间这一不变子空间的直和分解并不对所有线性变换成立，于是我们很自然地会有一个想法，即我们能否将线性变换的特征子空间进行某种扩张，使得扩张后的特征子空间的直和能够张成整个线性空间呢？如果这样可行我们至少可以得到一个分块对角矩阵，这样的矩阵大概在我们可接受的相似标准形内.

事实上，这一想法是完全可行的，因为只要我们观察到$\sigma$在特征值$\lambda$下的特征子空间实际上就是$\ker(\lambda I-\sigma)$，并且我们敏锐的直觉能让我们想起我们曾经讲过核空间可以扩张的性质（\autoref{thm:核空间性质}），这一想法便已经找到了依据，为了讨论的方便我们重新叙述一下核空间扩张的性质：
\begin{theorem}{}{}
    设$\sigma\in \mathcal{L}(V)$，则有
    \begin{enumerate}
        \item $\{0\}=\ker \sigma^0\subseteq\ker \sigma^1\subseteq\cdots\subseteq\ker \sigma^k\subseteq\ker \sigma^{k+1}\subseteq\cdots$；

        \item 设$m$是非负整数使得$\ker \sigma^m=\ker \sigma^{m+1}$，则
              \[\ker \sigma^m=\ker \sigma^{m+1}=\ker \sigma^{m+2}=\ker \sigma^{m+3}=\cdots\]

        \item 令$n=\dim V$，则$\ker \sigma^n=\ker \sigma^{n+1}=\ker \sigma^{n+1}=\cdots$.
    \end{enumerate}
\end{theorem}

回忆核空间讨论的内容，我们知道这一定理还有一个自然的推论：
\begin{theorem}{}{核空间扩张分解}
    设$\sigma\in\mathcal{L}(V)$，设$n=\dim V$，则$V=\ker \sigma^n\oplus \im \sigma^n$.
\end{theorem}
\begin{proof}
    设 $v \in \ker \sigma^n \cap \im \sigma^n$，则$\exists u \in V$，使得$是v=\sigma^n(u)$，从而$u \in \ker \sigma^{2n}$，进而$u \in \ker \sigma^{n}$， $v=\sigma^n(u)=0$，这表明$\ker \sigma^n \cap \im \sigma^n=\{0\}$.

    结合$\dim \ker\sigma^n+\dim \im\sigma^n=n=\dim V$可知$V=\ker\sigma^n\oplus\im\sigma^n$.
\end{proof}

因此，如果我们考虑$\ker(\sigma-\lambda I)^n$，其中$n$是$\sigma$对应线性空间的维数，那么我们可以获得比特征子空间更大的核空间，这样扩张后的核空间的直和是否可以张成整个原空间呢？我们可以提前给出答案：可以，这便是我们下一小节中要证明的主要定理，在此之前，我们需要首先给这一扩张后的特征子空间一个新的名字.

\subsection{广义特征子空间与分块对角矩阵}

\begin{definition}{}{}
    设$V$是$n$维线性空间，$\sigma\in \mathcal{L}(V)$，$\lambda\in\mathbf{F}$是$\sigma$的特征值，若向量$v\neq 0$且存在正整数$j$使得$(\sigma-\lambda I)^jv=0$，则称$v$为$\sigma$对应于$\lambda$的\term{广义特征向量}\index{tezhengxiangliang!guangyi@广义 (generalized eigenvector)}. $\sigma$对应于$\lambda$的全体广义特征向量与0向量构成的集合称为$\sigma$相应于$\lambda$的\term{广义特征子空间}\index{tezhengzikongjian!guangyi@广义 (generalized eigenspace)}，记为$G(\lambda,\sigma)$，在不引起歧义的情况下也可以省略线性变换记为$G_\lambda$.
\end{definition}

实际上，根据\autoref{thm:核空间性质} 提到的核空间停止增长的性质，我们有$G_\lambda=\ker (\sigma-\lambda I)^n$，这也对应于上一小节末的讨论. 注意我们不定义广义特征值，因为若$\lambda$原先不是特征值，因此$\sigma-\lambda I$可逆，可逆映射复合仍可逆，故对于任意的$j$，$(\sigma-\lambda I)^j$仍可逆，即特征值是不会随着线性变换幂次增加而增加的.

类似于特征值与特征向量的讨论，对于矩阵我们也可以讨论广义特征向量，实际上就是满足存在正整数$j$使得$(A-\lambda I)^jv=0$的向量$v$，这样的向量称为矩阵$A$对应于特征值$\lambda$的广义特征向量. 对于$n$阶矩阵，$A^kX=0$的解空间与核空间的性质也是完全一致的，因此广义特征子空间就等于$\ker(A-\lambda E)^n$. 为了我们叙述的简洁性，后面矩阵的等价表述我们就不再给出，读者完全可以自行推导. 另一个关键的问题是线性变换与其矩阵表示的广义特征向量的关系，事实上完全类似于特征向量之间的关系，即坐标对应的关系，证明也与特征向量的证明类似，这里也不再赘述.

在定义了特征子空间的扩张后，我们接下来的目标转向我们的主要定理，即证明这样的扩张的确能使得对任意线性变换，扩张得到的广义特征子空间是不变子空间，并且它们的和为直和，且直和为原空间，这三点缺一不可，否则都无法满足\autoref{thm:不变子空间与分块对角矩阵} 的要求. 接下来我们就来叙述并证明这一定理.
\begin{theorem}{}{广义特征性质}
    设$V$是复数域上的$n$维线性空间，$\sigma\in \mathcal{L}(V)$. 用$\lambda_1,\ldots,\lambda_m$表示$\sigma$的所有互异特征值.
    \begin{enumerate}[label=(\arabic*)]
        \item \label{item:16:广义特征性质:1}
              每个$(\sigma-\lambda_j I)\vert_{G_{\lambda_j}}$都是幂零的；

        \item 每个$G_{\lambda_i}$在$\sigma$下都是不变的；

        \item $\sigma$对应于不同特征值的广义特征向量线性无关，故不同特征值对应的广义特征子空间的和为直和；

        \item \label{item:16:广义特征性质:4}
              $V=G_{\lambda_1}\oplus\cdots\oplus G_{\lambda_m}$，故$V$有一组由$\sigma$的广义特征向量组成的基；

        \item 若$\lambda\neq\lambda_j$，则$(\sigma-\lambda I)\vert_{G_{\lambda_j}}$是双射.
    \end{enumerate}
\end{theorem}

\begin{proof}
    \begin{enumerate}
        \item $\forall v\in G_{\lambda_i}$，则根据$G_{\lambda_i}$定义可知$(\sigma-\lambda_i I)^nv=0$，因此限制在$G_{\lambda_i}$上，$((\sigma-\lambda_i I)\vert_{G_{\lambda_i}})^n$将所有向量化零，因此就是零线性变换，故是幂零的.

        \item 设$v\in G_{\lambda_i}$，则根据$G_{\lambda_i}$定义可知这等价于存在正整数$j$使得$(\sigma-\lambda_i I)^jv=0$. 考虑$\sigma(v)$，我们有
              \[(\sigma-\lambda_i I)^j(\sigma(v))=\sigma((\sigma-\lambda_i I)^j(v))=0,\]
              其中$\sigma$与$(\sigma-\lambda_i I)^j$可交换是来源于\autoref{ex:矩阵多项式可交换}.

        \item 设$v_1,\ldots,v_m$分别是$\lambda_1,\ldots,\lambda_m$对应的广义特征向量，设复数$c_1,\ldots,c_m$使得
              \begin{equation} \label{eq:16:广义特征向量线性无关}
                  c_1v_1+\cdots+c_mv_m=0,
              \end{equation}
              令$k$是使得$(\sigma-\lambda_1 I)^kv_1\neq 0$成立的最大非负整数，令
              \[w=(\sigma-\lambda_1 I)^{k}v_1,\]
              则$(\sigma-\lambda_1 I)w=0$，即$\sigma(w)=\lambda_1w$，因此对于任意的$\lambda\in\mathbf{C}$，我们有
              \[(\sigma-\lambda I)w=(\lambda_1-\lambda)w,\]
              归纳可知$(\sigma-\lambda I)^nw=(\lambda_1-\lambda)^nw$.

              根据广义特征子空间的定义，$(\sigma-\lambda_i I)^nv_i=0,\enspace i=1,\ldots,m$，故我们对\autoref{eq:16:广义特征向量线性无关} 两边同时作用
              \[(\sigma-\lambda_1 I)^k(\sigma-\lambda_2 I)^n\cdots(\sigma-\lambda_m I)^n\]
              可得
              \begin{align*}
                  0 & = c_1(\sigma-\lambda_1 I)^k(\sigma-\lambda_2 I)^n\cdots(\sigma-\lambda_m I)^nv_1 \\
                    & = c_1(\sigma-\lambda_2 I)^n\cdots(\sigma-\lambda_m I)^nw                         \\
                    & = c_1(\lambda_1-\lambda_2)^n\cdots(\lambda_1-\lambda_m)^nw,
              \end{align*}
              由于$(\lambda_1-\lambda_2)^n\cdots(\lambda_1-\lambda_m)^n\neq 0$，因此$c_1=0$，同理可得$c_2=\cdots=c_m=0$，因此$v_1,\ldots,v_m$线性无关. 根据线性无关性可知，$G_{\lambda_1}\oplus\cdots\oplus G_{\lambda_m}$为直和是显然的（特征子空间也有完全一致的讨论）.

              这一线性无关的证明思想相信读者并不陌生，只是有一些独特的细节处理. 这种排除其它系数只留下一个系数必须为零的技巧我们已经多次见到.

        \item 我们通过对$V$的维数$n$进行归纳来证明. 当维数为1时，结论是显然的. 假设对任意小于$n$的维数结论都成立，现在我们对维数为$n$的情况证明. 由于是复向量空间，则必然有一个特征值$\lambda_1$，对应的广义特征子空间$G(\lambda_1,\sigma)$（使用这一记号是为了防止后续线性变换不同引起歧义）的维数不小于1. 由\autoref{thm:核空间扩张分解}，我们有
              \[V=\ker(\sigma-\lambda_1 I)^n\oplus\im(\sigma-\lambda_1 I)^n,\]
              即
              \begin{equation} \label{eq:16:广义特征子空间分解}
                  V=G(\lambda_1,\sigma)\oplus W,
              \end{equation}
              其中$W=\im(\sigma-\lambda_1 I)^n$. 又根据\autoref{ex:多项式不变子空间} 可知$W$是$\sigma$的不变子空间，又根据\autoref{eq:16:广义特征子空间分解} 可知$\dim W<n$，因此我们可以考虑对$\sigma\vert_W$使用归纳假设，有
              \[W=G(\lambda_2,\sigma\vert_W)\oplus\cdots\oplus G(\lambda_m,\sigma\vert_W),\]
              因此为了完成证明，我们只需证明$G(\lambda_i,\sigma)=G(\lambda_i,\sigma\vert_W),\enspace i=2,\ldots,m$，而根据广义特征子空间的定义，包含关系$G(\lambda_i,\sigma\vert_W)\subset G(\lambda_i,\sigma)$是显然的，因此我们只需证明另一半包含. 设$v\in G(\lambda_i,\sigma)\subset V$，由\autoref{eq:16:广义特征子空间分解} 可知$v=v_1+w$，其中$v_1\in G(\lambda_1,\sigma),w\in W$. 而由归纳假设，$w=v_2+\cdots+v_m$，其中$v_i\in G(\lambda_i,\sigma\vert_W)$，因此$v=v_1+v_2+\cdots+v_m$，改写一下得到
              \[v_1+\cdots+(v_i-v)+\cdots+v_m=0,\]
              而我们根据上一条证明知道对应于不同特征值的广义特征向量线性无关，而$v_i-v\in G(\lambda_i,\sigma)$，因此只能有$v_1=\cdots=v_{i-1}=v_{i+1}=\cdots=v_m=0$，且$v=v_i$. 特别地有$v_1=0$，因此$v=w=v_i\in G(\lambda_i,\sigma\vert_W)$，故包含得证.

              最后我们结合本定理的3和4，取每个广义特征子空间的基拼在一起可以立刻得到$V$的一组由$\sigma$的广义特征向量组成的基.

        \item 很显然，因为$(\sigma-\lambda I)v=0$要么只有零解（$\lambda$不是特征值），要么解在$V_\lambda\in G_\lambda$中（$\lambda$是特征值），总而言之不可能在$G_{\lambda_j}$中，因此$(\sigma-\lambda I)\vert_{G_{\lambda_j}}$核空间为零空间，故是单射，根据\autoref{thm:双射等价条件} 可知也是双射.
    \end{enumerate}
\end{proof}

结合\autoref{thm:不变子空间与分块对角矩阵}，上述定理的结果告诉我们，对于任意一个复向量空间上的线性变换，我们都可以找到一组基使得这个线性变换的矩阵是分块对角矩阵，而任意一个矩阵都可以相似于一个分块对角矩阵. 自然地，我们很容易发现如果每个广义特征子空间就等于特征子空间，那么我们的定理就退化为可对角化的情况，即我们有如下推论：
\begin{corollary}{}{}
    线性变换$\sigma$（或矩阵$A$）可对角化，当且仅当$\sigma$（或$A$）的任意特征值都满足$G(\lambda,\sigma)=E(\lambda,\sigma)$，即每个特征值对应的广义特征子空间等于特征子空间.
\end{corollary}

下面我们简要讨论如何将这一标准形求解出来. 事实上，根据上述定理的证明，我们发现每个对角块都是从一个广义特征子空间得来的，因此我们只需求出各个广义特征子空间的基，然后写出对应的矩阵即可. 我们来看一个例子：
\begin{example}{}{}
    设$\sigma\in \mathcal{L}(\mathbf{C}^3)$定义为
    \[\sigma(z_1,z_2,z_3)=(6z_1+3z_2+4z_3,6z_2+2z_3,7z_3),\]求一组基使其有分块对角矩阵并写出对应的分块对角矩阵.
\end{example}

\begin{solution}
    $\sigma$在$\mathcal{L}(\mathbf{C}^3)$的自然基下的矩阵是
    \[ \begin{pmatrix}
        6 & 3 & 4 \\
        0 & 6 & 2 \\
        0 & 0 & 7
    \end{pmatrix} \]
    $\sigma$的特征值为$\lambda_1=6,\lambda_2=7$.

    解方程可以得到两个广义特征子空间$G(\lambda_1,\sigma)=\spa((1,0,0),(0,\dfrac{1}{3},0))$，$G(\lambda_2,\sigma)=\spa((0,2,1))$.

    取$\alpha_1=(1,0,0),\alpha_2=\dfrac{1}{3},\alpha_3=(0,2,1)$，则$\sigma$在基$\{\alpha_1,\alpha_2,\alpha_3\}$下有分块对角矩阵
    \[ \begin{pmatrix}
        6 & 1 & 0 \\
        0 & 6 & 0 \\
        0 & 0 & 7
    \end{pmatrix} \]
\end{solution}

事实上，读者会发现虽然整体思路是很简单的，但是中间求解广义特征子空间的过程还是存在一定的困难. 因为当$\dim V$较大时，$G(\lambda,\sigma)=\ker (\sigma-\lambda I)^{\dim V}$的求解需要反复计算幂次，是比较复杂的；而如果根据核空间停止增长的性质不断提升矩阵的幂次，直到得到的广义特征子空间不再发生改变就能够停止计算也是一种可行的思路，只是每次算出一个幂次后都要判断线性变换或矩阵的秩是否下降. 在之后的章节中我们会通过多项式的理论来降低$\ker (\sigma-\lambda I)^{\dim V}$所需的幂次.

当然，有的读者或许认为到目前为止我们对于复数域上线性变换与矩阵的标准形讨论已经进入尾声，毕竟我们已经按照\autoref{thm:不变子空间与分块对角矩阵} 提供的范式找到了对任意线性变换都存在的不变子空间分解，得到了分块对角矩阵的标准形. 然而分块对角矩阵有时候可能会遇到分块很大的情况，或者矩阵本身只有一个特征值因此整个矩阵就是唯一的分块，这时矩阵并不一定足够简单，所以在后续我们后续我们还会通过更加精细的分解来实现更漂亮的矩阵标准形. 在下一节中我们给出一个对于这一问题不成熟但对于研究复数域上不变子空间性质很重要的解决方案，即给出上三角矩阵这一类任意复数域上线性变换和矩阵都可以得到的矩阵标准形.

\section{上三角矩阵}

我们研究矩阵标准形，很大一部分原因就是希望将对所有矩阵的研究都转向一个性质很好的矩阵的研究，这样之后的运算等就会非常方便（例如我们之前看到的利用对角化计算矩阵的幂）. 在之前的讨论中，我们已经见到了上三角矩阵的一些优良性质，事实上上三角矩阵的特征值求解也是很显然的问题：
\begin{theorem}{}{}
    设$A$为上三角矩阵，则$A$的特征值恰好就是其主对角元，且在对角线上出现的次数就等于特征值的代数重数.
\end{theorem}
\begin{proof}
    我们知道$A$的特征值就是$|\lambda E-A|=0$的零点，而
    \[|\lambda E-A|=\begin{vmatrix}
            \lambda-a_{11} & a_{12}         & \cdots & a_{1n}         \\
            0              & \lambda-a_{22} & \cdots & a_{2n}         \\
            \vdots         & \vdots         & \ddots & \vdots         \\
            0              & 0              & \cdots & \lambda-a_{nn}
        \end{vmatrix}=(\lambda-a_{11})(\lambda-a_{22})\cdots(\lambda-a_{nn}),\]
    因此很显然这一定理成立.
\end{proof}

因此上三角矩阵也是一个可行的方向. 与\autoref{thm:不变子空间与分块对角矩阵} 中推导分块对角矩阵等价条件的思路类似，我们需要首先观察上三角矩阵的性质的等价条件，然后尝试验证某个等价条件是否对所有线性变换和矩阵都成立的.

\subsection{上三角标准形的存在性}

\begin{theorem}{}{上三角矩阵等价条件}
    设$\sigma\in \mathcal{L}(V)$，且$v_1,v_2,\ldots,v_n$是$V$的基，则以下条件等价：
    \begin{enumerate}
        \item $\sigma$关于$v_1,v_2,\ldots,v_n$的矩阵是上三角的；

        \item 对每个$j=1,\ldots,n$有$\sigma(v_j)\in\spa(v_1,\ldots,v_j)$；

        \item 对每个$j=1,\ldots,n$有$\spa(v_1,\ldots,v_j)$在$\sigma$下不变.
    \end{enumerate}
\end{theorem}
定理的证明实际上只需要计算验证即可，非常简单：
\begin{proof}
$1 \implies 2$：设$\sigma$关于$v_1,\ldots,v_n$的矩阵$A=(a_{ij})_{n\times n}$是上三角的，即$a_{ij}=0,\forall i>j$. 则对于$\forall j \in \{1,\ldots,n\}$，有$\sigma(v_j)=\displaystyle\sum_{i=1}^{n}a_{ij}v_i=\displaystyle\sum_{i=1}^{j}a_{ij}v_i\in  \spa(v_1,\ldots,v_n)$.

$2 \implies 3$：对$\forall v=\displaystyle\sum_{i=1}^{j}a_iv_i \in \spa(v_1,\ldots,v_j)$，有$\sigma(v)=\sigma(\displaystyle\sum_{i=1}^{j}a_iv_i)=\displaystyle\sum_{i=1}^{j}a_i\sigma(v_i)$.
由2知对于$\forall i \in \{1,\ldots,j\}$，有$\sigma(v_i) \in \spa(v_1,\ldots,v_i) \subseteq \spa(v_1,\ldots,v_j)$，从而知$\sigma(v) \in \spa(v_1,\ldots,v_j)$，$\spa(v_1,\ldots,v_j)$在$\sigma$下不变.

$3 \implies 1$：设$\sigma$关于$v_1,\ldots,v_n$的矩阵为$A=(a_{ij})_{n\times n}$对于$\forall j \in \{1,\ldots,n\}$，$\sigma(v_j)=\displaystyle\sum_{i=1}^{n}a_{ij}v_i\in \spa(v_1,\ldots,v_n)$，从而有$a_{j+1,j}=\cdots=a_{n,j}=0$，即$\forall i>j,a_{ij}=0$. 故$A$为上三角矩阵.
\end{proof}

这一定理给出了上三角矩阵的几个充要条件，因此我们的想法就是利用等价条件中的某一个条件来验证任意线性变换是否可以得到上三角矩阵. 幸运的是，的确对于任意的复向量空间上的线性变换，我们可以找到一组基使得其关于这组基有上三角矩阵.
\begin{theorem}{}{上三角矩阵存在}
    设$V$是有限维复向量空间，对于任意的$\sigma\in \mathcal{L}(V)$，则一定存在$V$的一组基使得$\sigma$关于该组基有上三角矩阵.
\end{theorem}
\begin{proof}
    仍然是经典的数学归纳法，$n=1$时结论显然. 现假设小于$n$维的复向量空间上的线性变换都可以找到一组基使得其关于这组基有上三角矩阵，现在考虑$n$维复向量空间. 因为是复向量空间，故$\sigma$一定存在特征值. 设$\lambda_1$是$\sigma$的一个特征值，我们考虑$U=\im(\sigma-\lambda_1 I)$，且$U$是$\sigma$的比$V$维数更小的不变子空间，因此我们可以用归纳假设，$U$存在一组基$u_1,\ldots,u_m$使得$\sigma\vert_U$有上三角矩阵. 根据\autoref{thm:上三角矩阵等价条件}，我们知道对于每个$j$都有
    \[\sigma(u_j)=\sigma\vert_U(u_j)\in\spa(u_1,\ldots,u_j),\]
    这里我们只得到一部分的基使得限制映射有上三角矩阵，接下来我们要扩张到全空间上实现定理证明. 将上面取到的基扩充为
    \[u_1,\ldots,u_m,v_1,\ldots,v_k,\]
    要使得$\sigma$关于这组基有上三角矩阵，根据\autoref{thm:上三角矩阵等价条件}，我们只需验证对每个$i$都有$\sigma(v_i)\in\spa(u_1,\ldots,u_m,v_1,\ldots,v_i)$. 这是显然的，因为$\sigma(v_i)=(\sigma-\lambda_1 I)(v_i)+\lambda_1 v_i$，而根据$U$的定义$\sigma-\lambda_1 I$的像在$U$中，因此$\sigma(v_i)\in\spa(u_1,\ldots,u_m,v_1,\ldots,v_i)$，因此我们可以得到一组基使得$\sigma$关于这组基有上三角矩阵.
\end{proof}

综合\autoref{thm:上三角矩阵等价条件} 的第3点和\autoref{thm:上三角矩阵存在}，我们可以观察到不变子空间的另一个有趣的性质：
\begin{corollary}{}{}
    设$V$是$n$维复向量空间. $\sigma\in \mathcal{L}(V)$，则对任意的正整数$r\enspace(1\leqslant r\leqslant n)$，$\sigma$有$r$维不变子空间.
\end{corollary}
这是因为任意复向量空间上的线性变换都存在一组基使得矩阵表示为上三角矩阵，而存在上三角矩阵的其中一个充要条件是存在任意维数的不变子空间，因此任意复向量空间上的线性变换都存在任意维数的不变子空间. 如果我们更进一步地利用\autoref{thm:上三角矩阵等价条件} 的第三点，我们有如下推论：
\begin{corollary}{}{}
    设$V$是$n$维复向量空间. $\sigma\in \mathcal{L}(V)$，则存在$\sigma$的不变子空间$V_0,V_1,\ldots,V_n$使得$V_0\subseteq V_1\subseteq\cdots\subseteq V_n$，且$\dim V_i=i$.
\end{corollary}

事实上，根据\autoref{thm:上三角矩阵存在}，我们可以综合分块对角矩阵的存在性，将每个广义特征子空间的基取成上三角矩阵的基，然后将这些基拼在一起，就可以得到一个每个分块都是上三角矩阵的分块对角矩阵，显然比之前单纯的分块对角矩阵和上三角矩阵都要简单：
\begin{theorem}{}{分块对角矩阵}
    设$V$是复向量空间，$\sigma\in \mathcal{L}(V)$. 设$\lambda_1,\ldots,\lambda_m$是$\sigma$的所有互不相同的特征值，重数分别为$d_1,\ldots,d_m$，则$V$有一组基使得$\sigma$关于这组基的有分块对角矩阵
    \[\begin{pmatrix}
            A_1 &  & O \\  & \ddots &  \\ O &  & A_m
        \end{pmatrix}\]
    其中每个$A_j$都是如下所示的$d_j\times d_j$上三角矩阵
    \[A_j=\begin{pmatrix}
            \lambda_j &  & * \\  & \ddots &  \\ O &  & \lambda_j
        \end{pmatrix}\]
\end{theorem}

根据相似的定义，\autoref{thm:上三角矩阵存在} 的结论与``任意$n$阶复矩阵一定相似于一个上三角矩阵''是等同的，进入矩阵的范畴我们如同从抽象的表达中解脱，所以我们这里也展示一种使用分块矩阵结合数学归纳法的方法进行证明.
\begin{proof}
    数学归纳法，$n=1$时结论显然，因为任意一阶矩阵本身就是上三角矩阵. 现假设$n-1$阶复矩阵都可以相似于上三角矩阵，设$A$为$n$阶复矩阵，我们任取$A$的一个复特征值$\lambda_1$，设$\alpha_1$为$A$对应于$\lambda_1$的特征向量. 我们把$\alpha_1$扩充为$\mathbf{C}^n$的一组基，记为$\alpha_1,\alpha_2,\ldots,\alpha_n$，记$P_1=(\alpha_1,\alpha_2,\ldots,\alpha_n)$，则$P_1$可逆，且
    \[P_1^{-1}AP_1=\begin{pmatrix}
            \lambda_1 & \alpha' \\ 0 & A_{n-1}
        \end{pmatrix},\]

    我们对$n-1$阶矩阵$A_{n-1}$应用归纳假设，因此存在可逆矩阵$P_2$使得$P_2^{-1}A_{n-1}P_2$为上三角矩阵，取$P=P_1\begin{pmatrix}
            1 & 0 \\ 0 & P_2
        \end{pmatrix}$，直接有
    \[P^{-1}AP=\begin{pmatrix}
            \lambda_1 & \alpha'P_1 \\ 0 & P_2^{-1}A_{n-1}P_2
        \end{pmatrix}\]
    为上三角矩阵，因此$n$阶复矩阵一定相似于上三角矩阵.
\end{proof}

事实上，我们在这里介绍这一证明的一个重要的目的在于，这一证明给了我们一个求解线性变换（或矩阵）上三角化的方法. 与对角化等类似，线性变换的上三角化依赖于矩阵上三角化，因此我们这里只讨论矩阵的情况. 根据上面的证明，我们只需任意挑选$n$阶矩阵的一个特征值和一个对应的特征向量，然后问题就转化为求解$n-1$阶矩阵的上三角化问题，那么我们继续求出$n-1$阶矩阵的一个特征值和一个对应的特征向量，依次类推直到一阶的情况. 我们给出下面的例子供读者运用这一方法：
\begin{example}{}{}
    设$\sigma\in\mathbf{C}^3$定义为$\sigma(x,y,z)=(2x,0,x+2z)$，求$\mathbf{C}^3$的一组基使得$\sigma$在这组基下的矩阵为上三角矩阵.
\end{example}

\begin{solution}
    $\sigma$在$\mathbf{C}^3$的自然基下的矩阵$A$为
    \[ \begin{pmatrix}
        2 & 0 & 0 \\
        0 & 0 & 0 \\
        1 & 0 & 2
    \end{pmatrix} \]

    令$|\lambda_E-A|=0$，知$A$的一个特征值是$0$，相应的一个特征向量为$\alpha_1=(0,1,0)$.$\sigma$在$\alpha_1,e_1,e_3$下的矩阵为矩阵
    \[ \begin{pmatrix}
        0 & 0 & 0 \\
        0 & 2 & 0 \\
        0 & 1 & 2
    \end{pmatrix} \]
    再考虑矩阵
    \[ \begin{pmatrix}
        2 & 0 \\
        1 & 2
    \end{pmatrix} \]
    这个矩阵的特征值为$2$，相应的特征向量为$\alpha_2=(2,0,1)$. 最后取$\alpha_3=(0,0,1)$，则$\sigma$在$\alpha_1,\alpha_2,\alpha_3$下的矩阵为上三角矩阵.
\end{solution}

另一方面，我们可以再给出一个\autoref{thm:上三角矩阵存在} 的证明与这一矩阵的证明方法对应：
\begin{proof}
    数学归纳法，$n=1$时结论显然，现假设维数小于$n$的复向量空间上的线性变换都可以找到一组基使得其关于这组基有上三角矩阵，现在考虑$n$维复向量空间. 因为是复向量空间，故$\sigma$一定存在特征值. 设$\lambda_1$是$\sigma$的一个特征值，$v_1$是对应的特征向量. 设$U=\spa(v_1)$，这是1维不变子空间，剩下我们需要处理$n-1$阶的子空间——我们很自然地求助于商空间，因为$V/U$是一个很自然的$n-1$维复向量空间，我们可以考虑商映射$\sigma/U\in\mathcal{L}(V/U)$，我们可以根据归纳假设，存在$V/U$的一组基使得$\sigma/U$关于这组基$v_2+U,\ldots,v_n+U$有上三角矩阵，根据\autoref{thm:上三角矩阵等价条件}，我们知道对每个$j$都有
    \[(\sigma/U)(v_j+U)=\sigma(v_j)+U\in\spa(v_1+U,\ldots,v_j+U),\]
    因此$\sigma(v_j)\in\spa(v_1,\ldots,v_j)$，因此结合$v_1$是特征向量的性质，我们可以得到一组基$v_1,\ldots,v_n$使得$\sigma$关于这组基有上三角矩阵.
\end{proof}

这里我们利用了商空间和商映射与矩阵的证明方法产生了对应：我们都是求助于特征值，它可以让我们在矩阵的第一列上符合上三角性质，然后我们获得低一阶的矩阵或者底一维的子空间，然后直接利用归纳假设即可证明. 因此其实基于矩阵和基于抽象映射和空间的证明方法从某种角度来看是可以相互翻译的.

\subsection{矩阵可交换的讨论}
接下来我们要讨论一个特别的问题，即线性变换/矩阵可交换的性质. 我们有如下定理：
\begin{theorem}{}{线性变换可交换}
    设$V$为$n$维复向量空间，$\sigma,\tau\in \mathcal{L}(V)$，$\sigma\tau=\tau\sigma$，则
    \begin{enumerate}
        \item $\sigma$的每个特征子空间都是$\tau$的不变子空间；

        \item $\sigma,\tau$有公共的特征向量.
    \end{enumerate}
\end{theorem}
\begin{proof}
    \begin{enumerate}
        \item 设$\lambda$是$\sigma$的一个特征值，$V_\lambda$是对应的特征子空间，我们要证明$V_\lambda$是$\tau$的不变子空间. 事实上，对于任意的$v\in V_\lambda$，有$\sigma(v)=\lambda v$，故$\sigma(\tau(v))=\tau(\sigma(v))=\lambda\tau(v)$，即$\tau(v)\in V_\lambda$，因此$V_\lambda$是$\tau$的不变子空间.

        \item 由于$V_\lambda$是$\tau$的不变子空间，考虑限制映射$\tau\vert_{V_\lambda}$，因为定义在复向量空间上的线性变换一定有特征值，故存在$\mu$是$\tau\vert_{V_\lambda}$的一个特征值，且存在$u\in V_\lambda$使得$\tau(u)=\mu u$，又$V_\lambda$是$\sigma$的特征子空间，因此$u$是$\sigma$和$\tau$的公共特征向量.
    \end{enumerate}
\end{proof}

将这一定理的线性变换改为矩阵实际上是等价的，读者完全可以自行推导. 接下来我们希望应用这上述定理解决下面这一经典的问题：
\begin{example}{}{可交换与同时上三角化}
    设$V$为$n$维复向量空间，$\sigma,\tau\in \mathcal{L}(V)$，$\sigma\tau=\tau\sigma$，证明：
    \begin{enumerate}
        \item 若$\sigma$有$s$个不同的特征值，则$\sigma,\tau$至少有$s$个公共且线性无关的特征向量；

        \item 存在$V$的一组基，使得$\sigma$和$\tau$在这组基下的矩阵均为上三角矩阵.
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item 设$\lambda_1,\ldots,\lambda_s$是$\sigma$的$s$个不同的特征值，$V_{\lambda_1},\ldots,V_{\lambda_s}$是对应的特征子空间. 根据\autoref{thm:线性变换可交换}，$V_{\lambda_1},\ldots,V_{\lambda_s}$是$\tau$的不变子空间，并且根据\autoref{thm:线性变换可交换} 的2的证明我们可以在每个特征子空间中找到一个公共的特征向量，这样我们就找到了$s$个公共且线性无关的特征向量.

        \item 这一结论的证明与\autoref{thm:上三角矩阵存在} 类似，也有矩阵和商空间两个版
        限于篇幅这里只给出商空间版本的证明：
        我们对维数$n$归纳证明.
        \begin{enumerate}
            \item $n=1$时，结论显然成立.
            \item 假设命题对$n-1$成立. 由于$\sigma \tau=\tau \sigma$，故$\exists \alpha\in V$，使得$\alpha$同时为$\sigma$和$\tau$的特征向量.

            设$U=\spa{\alpha}$，则$U$是$\sigma$和$\tau$的不变子空间. 考虑商映射$\sigma/U,\tau/U$.
            对于$\forall v+U\in V/U$，有$((\sigma/U)(\tau/U))(v+U)=(\sigma/U)(\tau(v)+U)=\sigma(\tau(v))+U=\tau(\sigma(v))+U=((\tau/U)(\sigma/U))(v+U)$，即$(\sigma/U)(\tau/U)=(\tau/U)(\sigma/U)$.

            由$\dim V/U=n-1$，结合归纳假设可知：存在$V/U$的一组基$v_1+U,\ldots,v_{n-1}+U$，使得$\sigma/U$和$\tau/U$在这组基下都是上三角矩阵.

            则$(\sigma/U)(v_i+U)=\sigma(v_i)+U \in \spa(v_1+U,\ldots,v_i+U)$，从而$\sigma(v_i)\in \spa(\alpha,v_1,\ldots,v_i),\forall i=1,2,\ldots,n-1$.

            容易验证：$\alpha,v_1,\ldots,v_{n-1}$线性无关，从而构成$V$的基. 由上面的叙述可知$\sigma$在这组基下的矩阵为上三角矩阵. 同理，$\tau$在这组基下也为上三角矩阵，命题对$n$成立. 从而命题成立.
        \end{enumerate}
    \end{enumerate}
\end{proof}

这一例子的结论告诉我们：线性变换可交换对应于同时上三角化. 例中 2 的结论如果换为矩阵表述应当是：设$A,B$是复数域上的两个$n$阶矩阵，且$AB=BA$，则存在可逆矩阵$P$使得$P^{-1}AP$和$P^{-1}BP$同时为上三角矩阵.

\section{复数域上相似标准形理论的应用}

我们在前文已经基本完成了对复数域上线性变换的相似标准形基本理论的讨论，这一理论包括对角标准形的充要条件，任意线性映射的广义特征子空间分解与分块对角矩阵标准形，以及上三角矩阵的等价条件与存在性. 接下来我们将利用这些理论来解决一些具体的问题，本节我们主要讨论幂等矩阵、幂零矩阵的性质以及线性变换的平方根问题.

\subsection{幂等矩阵}

本节我们专门讨论一个常见的特殊矩阵：幂等矩阵. 若$n$阶方阵$A$满足$A^2=A$，则$A$称为幂等矩阵. 幂等矩阵具有如下基本性质：
\begin{enumerate}
    \item $A$是幂等矩阵等价于$r(A)+r(A-E)=n$；

    \item $A$为幂等矩阵则一定可对角化，特征值为0和1，其中1的重数等于$r(A)$；

    \item $A$是幂等矩阵时，$r(A)=\tr(A)$；

    \item 所有秩为1迹也为1的矩阵均为幂等矩阵.
\end{enumerate}

\begin{proof}
    \begin{enumerate}
        \item 参考\autoref{ex:线性方程组理论与秩不等式} 第四点的证明即可.

        \item 与\autoref{ex:可对角化经典例题} 第一问中解法类似可得$A$为幂等矩阵则一定可对角化，且特征值为0和1. 因为$A$可对角化，故0和1的代数重数等于几何重数（统称重数），且二者重数之和为$n$. 由于0的重数（从几何重数的角度看）就等于$AX=0$的解空间维数，即等于$n-r(A)$，因此1的重数等于$n-(n-r(A))=r(A)$.

        \item 事实上$\tr(A)$等于$A$的所有特征值之和. 事实上由上面的结论，幂等矩阵$A$特征值由$n-r(A)$个0和$r(A)$个1组成，即与幂等矩阵相似的对角矩阵为$\varLambda=\diag(0,\ldots,0,1,\ldots,1)$，其中有$r(A)$个1. 又因为相似矩阵有相同的特征值，因此对于任意的幂等矩阵$A$都有$\tr(A)=\tr(\varLambda)=r(A)$.

        \item 根据我们在相抵标准形中讨论的分解可知，所有秩为1的矩阵都可分解为一个列向量乘以行向量的形式，即$A=\alpha\beta^\mathrm{T}$，其中$\alpha,\beta$都是列向量. 并且同\autoref{ex:秩1矩阵可对角化} 中的讨论，$A$的迹即为$\alpha^\mathrm{T}\beta=\beta^\mathrm{T}\alpha=1$，因此
              \[A^2=(\alpha\beta^\mathrm{T})(\alpha\beta^\mathrm{T})=\alpha(\beta^\mathrm{T}\alpha)\beta^\mathrm{T}=\alpha\beta^\mathrm{T}=A,\]
              因此$A$是幂等矩阵.
    \end{enumerate}
\end{proof}

实际上，幂等矩阵还有很多其他的性质，我们可以回到线性变换的角度去理解这一矩阵，不仅仅是将上述定理换成线性变换的描述进行讨论（因为根据线性映射矩阵表示很容易知道，幂等线性变换在任意一组基下的矩阵表示都是幂等矩阵），我们还可以讨论其与投影变换的等价性，这一点我们将在后续内积空间讲解投影变换时中给出详细说明. 下面是一个技巧性较强的题目，读者可以在此题中体会``幂等''这一性质的特点：
\begin{example}{}{}
    设$A$，$B$为两个$n$阶幂等矩阵，证明：
    \begin{enumerate}
        \item $A+B$为幂等矩阵当且仅当$AB=BA=O$；

        \item $A-B$为幂等矩阵当且仅当$AB=BA=B$；

        \item 若$AB=BA$，则$AB$为幂等矩阵. 反之，若$AB$为幂等矩阵，是否必有$AB=BA$；

        \item 若$E-A-B$可逆，则$r(A)=r(B)$.
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item 必要性：由于$A+B$幂等，所以
              \[A+B=(A+B)^2=A^2+AB+BA+B^2=A+B+AB+BA,\]
              因此$AB+BA=O$，即$AB=-BA$. 又由于$A$和$B$均幂等，从而也有
              \[AB=A^2B=A(AB)=A(-BA)=-(AB)A=(BA)A=BA^2=BA.\]
              于是有$AB=BA=O$.

              充分性：由于$AB=BA=O$，因此
              \[(A+B)^2=A^2+AB+BA+B^2=A+B.\]
              因此$A+B$幂等.

        \item 必要性：由于$A-B$幂等，所以
              \[A-B=(A-B)^2=A^2-AB-BA+B^2=A+B-AB-BA,\]
              因此$AB+BA=2B$，即$AB=2B-BA$，从而也有
              \[AB=AB^2=(2B-BA)B=2B^2-B(AB)=2B^2-B(2B-BA)=B^2A=BA.\]
              于是有$AB=BA=B$.

              充分性：由于$AB=BA=B$，因此
              \[(A-B)^2=A^2-AB-BA+B^2=A-B.\]
              因此$A-B$幂等.

        \item 由于$AB=BA$，因此
              \[(AB)^2=ABAB=A(BA)B=A^2B^2=AB,\]
              因此$AB$幂等. 反之，取
              \[A=\begin{pmatrix}
                      1 & 0 & 1 \\ 0 & 0 & 0 \\ 0 & 0 & 0
                  \end{pmatrix},\enspace B=\begin{pmatrix}
                      1 & 1 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 0
                  \end{pmatrix},\]
              可以验证$AB$幂等，但$AB=B\neq A=BA$.

        \item 由于$E-A-B$可逆，因此
              \[r(A)=r(A(E-A-B))=r(A-A^2-AB)=r(AB)\leqslant r(B);\]
              \[r(B)=r(B(E-A-B))=r(B-B^2-BA)=r(BA)\leqslant r(A).\]
              因此$r(A)=r(B)$.
    \end{enumerate}
\end{proof}

\subsection{幂零矩阵}

基于之前核空间的讨论，并为了方便后面小节的研究，我们将讲解幂零线性变换与幂零矩阵的相关准备知识. 根据线性映射矩阵表示很容易知道，幂零线性变换在任意一组基下的矩阵表示都是幂零矩阵. 我们接下来首先讨论幂零线性变换的一些基本性质：
\begin{theorem}{}{幂零线性变换性质}
    设线性变换$N\in \mathcal{L}(V)$是幂零的，则
    \begin{enumerate}
        \item \label{item:16:幂零线性变换性质:1}
              $N$的所有特征值均为0（等价定义）；

        \item \label{item:16:幂零线性变换性质:2}
              $N^{\dim V}$=0；

        \item \label{item:16:幂零线性变换性质:3}
              $V$有一组基使得$N$关于这组基的矩阵对角线和对角线下方元素均为0（等价定义）；

        \item \label{item:16:幂零线性变换性质:4}
              $N\pm I$可逆.
    \end{enumerate}
\end{theorem}

\begin{proof}
    \begin{enumerate}
        \item 这一结论我们将在下一讲中介绍 \nameref{thm:HC}后给出证明；

        \item 考虑\autoref{thm:核空间性质}

        \item 考虑上三角矩阵

        \item 考虑矩阵版本，结合第一点可知$N+I$的特征值全为1，因此一定是可逆的.
    \end{enumerate}
\end{proof}

事实上 \ref*{item:16:幂零线性变换性质:1},\ref*{item:16:幂零线性变换性质:2},\ref*{item:16:幂零线性变换性质:4} 都有相应的矩阵的结论，我们将线性变换替换为它的矩阵表示即可，此处不再赘述. 而第三点则解释了我们在求矩阵的幂时将一些矩阵分解为一个矩阵加一个对角线上全为0的矩阵的合理性，因为后者一定是幂零的. 接下来我们来看一个比较经典的幂零矩阵的例子：
\begin{example}{}{}
    若$A,B$为两个$n$阶矩阵且满足$AB-BA=A$，证明：
    \begin{enumerate}
        \item $A$不可逆；

        \item $A$是幂零矩阵.
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item 由于$tr(A)=tr(AB-BA)=tr(AB)-tr(BA)=0$，而$tr(A)$为$A$的所有特征值之积，这表明$0$是$A$的特征值，从而$A$不可逆.
        \item 由$AB-BA=A$知$AB=BA+A$.

        考虑从$\mathbf{M}_n(F)$到自身的映射$\sigma:\sigma(X)=XB-BX$，则$\sigma(A)=A$.

        容易验证$\sigma$是线性映射. 归纳容易证明：$\sigma(A^k)=kA^k,\forall k\in \mathbb{N}^*$

        假设$A$不是幂零的，则对$\forall k \in \mathbb{N}^*$，有$A^k \neq 0,\sigma(A^k)=kA^k$. 这表明任意正整数$k$都是$\sigma$的特征值，这与$\sigma$最多只有$n^2$个特征值矛盾. 故$A$是幂零矩阵.
    \end{enumerate}
\end{proof}

\subsection{平方根问题}

在进入下一个话题前，我们先简单介绍线性变换平方根的概念，这一概念在之后内积空间线性变换会进一步说明.
\begin{definition}{}{}
    我们称线性变换$\sigma\in \mathcal{L}(V)$的平方根是满足$\tau^2=\sigma$的线性变换$\tau\in \mathcal{L}(V)$.
\end{definition}
在复向量空间中，我们有如下两个结论：
\begin{theorem}{}{幂零平方根}
    设$V$是复向量空间.
    \begin{enumerate}
        \item 设$N\in \mathcal{L}(V)$幂零，则$(I+N)$有平方根；

        \item \label{item:16:幂零平方根:2}
              若$\sigma\in \mathcal{L}(V)$可逆，则$\sigma$有平方根.
    \end{enumerate}
\end{theorem}

\begin{proof}
    \begin{enumerate}
        \item 从$\sqrt{1+x}=1+a_1x+a_2x^2+\cdots$受到启发，我们猜测$I+N$有形如$I+a_1N+a_2N^2+\cdots$的平方根.
        由于$N$是幂零的，故存在正整数$m$，使得$N^m=0$，从而上面的式子成为一个有限和$I+a_1N+a_2N^2+\cdots+a_{m-1}N^{m-1}$.

        我们希望$(I+a_1N+a_2N^2+\cdots+a_{m-1}N^{m-1})^2=I+2a_1N+(2a_2+a_1)N^2+(2a_3+2a_1a_2)N^3+\cdots+(2a_{m-1}+f(a_1,\ldots,a_{m-2})N^{m-1})$等于$I+N$. 所以取$2a_1=1$，再取$a_2$使得$2a_2+a_1^2=0$.

        对所有$j=3,4,\ldots,m-1$如此进行下去，每次都能得到相应的$a_j$，我们并不关心$a_j$的显式公式，只需知道这些$a_j$的选取确实给出了$(I+N)$的一个平方根.
        \item 设$\lambda_1,\ldots,\lambda_m$是$T$所有互不相同的本征值，则对每个$j$都存在一个幂零算子$N_j\in \mathcal{L}(G(\lambda_j,T))$使得$T|G_{(\lambda_j,T)}=\lambda_jI+N_j$. 因为$T$可逆，所以$\lambda_j \neq 0$，于是有$T|G_{\lambda_j,T}=\lambda_j(I+\dfrac{N_j}{\lambda_j})$.
        显然$\dfrac{N_j}{\lambda_j}$也是幂零的，故$(I+\dfrac{N_j}{\lambda_j})$有平方根，从而我们可以得到$T|G_{(\lambda_j,T)}$的一个平方根$R_j$.

        对于$\forall v\in V$，$v$可以唯一地写成$v=u_1+\cdots+u_m$，其中$u_j\in G(\lambda_j,T)$.

        我们定义算子$R\in\mathcal{L}(V):Rv=R_1u_1+\cdots+R_mu_m$. 不难验证我们定义的$R$即为$T$的平方根.
    \end{enumerate}
\end{proof}

我们发现，这一定理的证明思路基于$\sqrt{1+x}$的泰勒展开，我们不是第一次看到使用泰勒展开的情况，在求解矩阵的逆的进阶方法中，求逆的分式思想中也使用了 $\vphantom{\cfrac{1}{1-x}}\dfrac{1}{1-x}$的泰勒展开，足以体现一些数学直觉对于我们解决一些问题的重要性.

\begin{example}{}{}
    定义$N\in \mathcal{L}(\mathbf{F}^5)$为
    \[N(x_1,x_2,x_3,x_4,x_5)=(2x_2,3x_3,-x_4,4x_5,0)\]
    求$(I+N)$的一个平方根.
\end{example}

\begin{solution}
    由于$N^4=0$，我们设$\sqrt{I+N}=I+a_1N+a_2N^2+a_3N^3$，则$I+N=(I+a_1N+a_2N^2+a_3N^3)^2=I+2a_1N+(a_1^2+2a_2)N^2+(2a_3+2a_1a_2)N^3$，有$a_1=\dfrac{1}{2},a_2=-\dfrac{1}{8},a_3=\dfrac{1}{16}$. 代入即可算出$(I+N)$的一个平方根.
\end{solution}

最后，在开始习题内容前，我们需要讲解一类特殊的题型，即举例或举反例的问题. 一般而言，我们有如下两种思路：
\begin{enumerate}
    \item 考虑几何意义：例如旋转矩阵，特征值的几何意义等
          \begin{example}{}{}
              找出有限维实向量空间的一个线性变换$\sigma$，使得0是$\sigma$仅有的特征值但$\sigma$不是幂零线性变换.
          \end{example}
          \begin{solution}
            我们定义$\sigma\in\mathcal{L}({\mathbf{R}^3})$，$\sigma$在自然基下的矩阵为
            \[ \begin{pmatrix}
                0 & 1 & 0 \\
                -1 & 0 & 0 \\
                0 & 0 & 0
            \end{pmatrix} \]
            则$0$是$\sigma$仅有的特征值，但$\sigma^3=-\sigma\neq 0$，$\sigma$不为幂零线性变换.
          \end{solution}
          \begin{example}{}{}
              找出一个$\sigma\in \mathcal{L}(\mathbf{R}^2)$使得$\sigma^4=-I$.
          \end{example}
          \begin{solution}
            从旋转的角度考虑可以得到$\sigma(x,y)=(x,y)\cdot$
            \[ \begin{pmatrix}
                \dfrac{\sqrt{2}}{2} & -\dfrac{\sqrt{2}}{2} \\[2ex]
                \dfrac{\sqrt{2}}{2} & \dfrac{\sqrt{2}}{2}
            \end{pmatrix} \]
            满足.
          \end{solution}
    \item 考虑简单的情况：例如考虑2阶、3阶的简单线性变换/矩阵
          \begin{example}{}{}
              证明或给出反例：$V$上的幂零线性变换的集合是$\mathcal{L}(V)$的子空间.
          \end{example}
          \begin{solution}
            反例：$V=\mathbf{R}^2,\sigma,\tau$在自然基下的矩阵分别为
            \[ \begin{pmatrix}
                0 & 1 \\
                0 & 0
            \end{pmatrix}, \quad
            \begin{pmatrix}
                0 & 0 \\
                1 & 0
            \end{pmatrix}\]
            则$\sigma+\tau$在自然基下的矩为
            \[ \begin{pmatrix}
                0 & 1 \\
                1 & 0
            \end{pmatrix} \]
            表明$\sigma+\tau$不是幂零线性变换. 从而命题不成立.
          \end{solution}
          很多时候一些反例很难构想就选择记住这一构造思想即可. 一些反例可能基于一些简单的结论，但如果未思考到位可能很难构造.
\end{enumerate}

\begin{summary}

    本讲我们介绍了相似的定义与性质，并介绍了第一个且是最简单的相似标准形——对角矩阵. 我们介绍了线性变换和矩阵可对角化的定义以及二者的统一性，介绍了如何求解线性变换/矩阵的对角化问题. 我们也探讨了线性变换/矩阵可对角化的几个充分必要条件，并通过大量的例题运用了这些条件. 最后我们介绍了幂等矩阵这一特殊矩阵，它有很多值得探讨的性质，并且很适合于作为本讲的一个运用.

    从下一讲开始，我们将要介绍当线性变换/矩阵不可对角化时，它们可以有哪些退而求其次的也比较简单的相似标准形.

\end{summary}

\begin{exercise}
    \exquote[刘徽，《九章算术注·原序》]{事类相推，各有攸归，故枝条虽分而同本干知，发其一端而已.}

    \begin{exgroup}
        \item 请举例：存在两个矩阵相抵但不相似.
        \begin{answer}
            非常简单，可以举$\begin{pmatrix}
                1 & 0 \\ 0 & 1
            \end{pmatrix}$和$\begin{pmatrix}
                1 & 0 \\ 0 & 2
            \end{pmatrix}$的例子，也可以举一个可对角化另一个不可对角化的例子，因为上述情况矩阵对应的相似标准形不一样，故不相似.
        \end{answer}
        \item 求矩阵
        \[A = \begin{pmatrix}
                0  & -1 & 1 \\
                -1 & 0  & 1 \\
                1  & 1  & 0
            \end{pmatrix}\]
        的所有特征值，对应的特征子空间，以及与 $A$ 相似的一个对角矩阵.
        \begin{answer}
            解$|\lambda E-A|=0$可得特征值为$1,1,-2$. 然后解$(E-A)X=0$得$X=t_1(-1,1,0)^\mathrm{T}+t_2(1,0,1)^\mathrm{T}$；解$(-2E-A)X=0$，得$X=t(-1,-1,1)^\mathrm{T}$. 可见特征值1对应的特征子空间为$\spa((-1,1,0)^\mathrm{T},(1,0,1)^\mathrm{T})$，特征值$-2$对应的特征子空间为 $\spa((-1,-1,1)^\mathrm{T})$. 可知与$A$相似的对角矩阵为 $\diag(1,1,-2)$.
        \end{answer}
        \item 设$A=\begin{pmatrix}
                a & b \\ c & d
            \end{pmatrix}$为二阶实矩阵.
        \begin{enumerate}
            \item 若$|A|<0$，问：$A$与对角矩阵是否相似；

            \item 若$ad-bc=1$，$|a+d|>2$，问：$A$是否可对角化.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
                \item $f(\lambda)=|\lambda E-A|=\begin{vmatrix}
                              \lambda-a & -b \\ -c & \lambda-d
                          \end{vmatrix}=\lambda^2-(a+d)\lambda+(ad-bc)=\lambda^2-(a+d)\lambda+|A|$. 由于$|A|<0$，因此判别式$\Delta=(a+d)^2-4|A|>0$，因此二阶矩阵$A$有两个互异特征值，故可对角化，因此与对角矩阵相似；

                \item 同 (1)，判别式$\Delta=(a+d)^2-4|A|>0$，因此二阶矩阵$A$有两个不同的特征值，故可对角化.
            \end{enumerate}
        \end{answer}
        \item 设$A=\begin{pmatrix}
                1 & 1 & a \\
                1 & a & 1 \\
                a & 1 & 1
            \end{pmatrix}$，$\beta=\begin{pmatrix}
                1 \\ 1 \\ -2
            \end{pmatrix}$，方程组$AX=\beta$有解但不唯一.
        \begin{enumerate}
            \item 求$a$的值；

            \item 求可逆矩阵$P$使得$P^{-1}AP$为对角矩阵.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
              \item 由Cramer法则，$A$为方阵且$AX=\beta$有解但不唯一，即$|A|\neq 0$，解得$a=-2$或$a=1$，分别代入可知$a=1$时增广矩阵的秩为2，而$r(A)=1$，故无解；$a=-2$时增广矩阵的秩为2，而$r(A)=2$，故有解，故$a=-2$.

              \item 容易求得特征值为$0,-3,3$，求特征向量可知$P=\begin{pmatrix}
                            1 & -1 & 1 \\ 1 & 0 & -2 \\ 1 & 1 & 1
                        \end{pmatrix}$.
          \end{enumerate}
        \end{answer}
        \item 设$A$为三阶矩阵，$\alpha_1,\alpha_2,\alpha_3$线性无关，且$A\alpha_1=\alpha_1,A\alpha_2=\alpha_1+\alpha_2-2\alpha_3,A\alpha_3=\alpha_1-2\alpha_2+\alpha_3$，求$A$的特征值.
        \begin{answer}
            由分块矩阵乘法，$A(\alpha_1,\alpha_2,\alpha_3)=(A\alpha_1,A\alpha_2,A\alpha_3)=(\alpha_1,\alpha_1+\alpha_2-2\alpha_3,\alpha_1-2\alpha_2+\alpha_3)=(\alpha_1,\alpha_2,\alpha_3)\begin{pmatrix}
                1 & 1 & 1 \\ 0 & 1 & -2 \\ 0 & -2 & 1
            \end{pmatrix}$. 令$P=(\alpha_1,\alpha_2,\alpha_3)$，则$AP=P\begin{pmatrix}
                1 & 1 & 1 \\ 0 & 1 & -2 \\ 0 & -2 & 1
            \end{pmatrix}=PB$，即$P^{-1}AP=B$，故$A$与$B$相似，故两矩阵的特征值相同，简单求解$B$的特征值即得$A$的特征值为$1,-1,3$.
        \end{answer}
        \item 设三阶实对称矩阵$A$的各行元素之和为3，向量$\alpha_1=(-1,2,-1)^\mathrm{T}$，$\alpha_2=(0,-1,1)^\mathrm{T}$是方程组$AX=0$的两个解，求矩阵$P$使得$P^{-1}AP$为对角矩阵.
        \begin{answer}
            每行元素之和为3，则我们知道$\alpha=(1,1,1)^\mathrm{T}$是3对应的特征向量（具体理由只需要验证$A\alpha=3\alpha$即可，这是很常用的性质），而$AX=0$的解是对应特征值0的特征向量，故由题意可知取$P=\begin{pmatrix}
                1 & -1 & 0 \\ 1 & 2 & -1 \\ 1 & -1 & 1
            \end{pmatrix}$，则$P^{-1}AP=\begin{pmatrix}
                3 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 0
            \end{pmatrix}$.
        \end{answer}
    \end{exgroup}

    \begin{exgroup}
        \item 设$a\neq b$，且$(aE-A)(bE-A)=O$. 证明：$A$可对角化（特例：对合矩阵）；
        \begin{answer}
            回忆例题中$A^2=2A$，即$A(A-2E)=O$的证明，我们知道$A$的特征值只能为$a$或$b$，然后我们可以证明$r(aE-A)+r(bE-A)\leqslant n$和$r(aE-A)+r(bE-A)\geqslant n$，因此$r(aE-A)+r(bE-A)=n$，即$A$可对角化（由于和例题完全类似，这里不再展开具体做法）.
        \end{answer}

        \item 证明：满足$A^2=E$且特征值只有1的矩阵只能是$E$，特征值只有$-1$的矩阵只能是$-E$.
        \begin{answer}
            若$A^2=E$，则$A$可对角化.设$A=P^{-1}BP$，$B$为对角矩阵，若$A$的特征值只有$1$，则$B=E$，从而$A=P^{-1}EP=E$.若$A$的特征值只有$-1$，则$B=-E$，从而$A=-E$.
        \end{answer}

        \item 设$A$为三阶矩阵，$A^2=A$且$r(A)=r$，求$|A-2E|$.
        \begin{answer}
            根据例题中关于$A^2=A$的讨论可知，满足$A^2=A$的矩阵$A$可对角化（设过渡矩阵为$P$），特征值0和1的重数分别为$n-r$和$r$，因此$|A-2E|=|P^{-1}||A-2E||P|=|\diag(-1,\ldots,-1,-2,\ldots,-2)|=(-1)^r(-2)^{n-r}$.
        \end{answer}

        \item 设$T\in \mathcal{L}(\mathbf{C}^3)$使得6和7是$T$的特征值，且$T$不可对角化. 证明：存在$(x,y,z)\in\mathbf{C}^3$使得$T(x,y,z)=(17+8x,\sqrt{5}+8y,2\pi+8z)$.
        \begin{answer}
            三阶矩阵如果有三个特征值则一定可对角化，故由题意$T$只能有6和7两个特征值. 故$\lambda\neq 6,7$时$T-\lambda I$都是可逆的（回顾正文中的定理），故$T-8I$可逆（故是满射），因此一定存在$(x,y,z)\in\mathbf{C}^3$使得$(T-8I)(x,y,z)=(17,\sqrt{5},2\pi)$，因此存在$(x,y,z)\in\mathbf{C}^3$使得$T(x,y,z)=(17+8x,\sqrt{5}+8y,2\pi+8z)$.
        \end{answer}

        \item 证明：两个可对角化的同阶矩阵特征值相同（包括重数）等价于它们相似. 对于不可对角化的矩阵来说，这一结论还成立吗？
        \begin{answer}
            可对角化矩阵特征值（包括重数）相等则相似标准形（对角矩阵）相等，故一定相似. 不可对角化的举例说明不成立：$\begin{pmatrix}
                0 & 1 & 0 \\ 0 & 0 & 1 \\ 0 & 0 & 0
            \end{pmatrix}$和$\begin{pmatrix}
                0 & 1 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 0
            \end{pmatrix}$的特征值全为0（重数均为3），但它们对应不同的若当标准形（之后章节会介绍），因此不相似.
        \end{answer}

        \item 设$A=\begin{pmatrix}
                2 & 2 & 0 \\ 8 & 2 & a \\ 0 & 0 & 6
            \end{pmatrix}$相似于对角矩阵，求常数$a$，并求可逆矩阵$P$使得$P^{-1}AP$为对角矩阵.
        \begin{answer}
            直接计算$|\lambda E-A|=0$，得到$A$的特征值为$-2,6,6$，因为$A$可对角化，则特征值6对应的特征子空间为2维，即$(6E-A)X=0$的解空间为2维，根据齐次线性方程组一般理论，$r(6E-A)=3-2=1$，即$r\begin{pmatrix}
                4 & -2 & 0 \\ -8 & 4 & -a \\ 0 & 0 & 0
            \end{pmatrix}=1$，显然$a=0$. 接下来求解-2和6对应的特征向量即可，得到可行的解$P=\begin{pmatrix}
                -1 & 1 & 0 \\ 2 & 2 & 0 \\ 0 & 0 & 1
            \end{pmatrix}$.
        \end{answer}

        \item 设$A=(a_{ij})_{n\times n}$是上三角矩阵.
        \begin{enumerate}
            \item 求$A$的全部特征值；

            \item 若$A$主对角元互不相等，证明：$A$与对角阵相似；

            \item 若$n$个主对角元相等且$A$不为对角矩阵，证明：$A$不与对角阵相似.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
                \item 上三角矩阵特征值就是所有主对角元$a_{ii},\enspace i=1,2,\ldots,n$；

                \item 由（1）知主对角元互不相等表示$A$有$n$个互不相等的特征值，故可对角化；

                \item 由（1）知此时$A$有一个$n$重特征值，记为$c$，则所有特征向量都在$(cE-A)X=0$的解空间中，而$r(cE-A)=1$，故解空间维数为$n-1<n$，故$A$不可对角化.
            \end{enumerate}
        \end{answer}

        \item 已知$\mathbf{R}^3$的一个线性变换
        \[\sigma(x_1,x_2,x_3)=(2x_1-2x_2,-2x_1+x_2-2x_3,-2x_2).\]
        \begin{enumerate}
            \item 求$\sigma$关于自然基$\{e_1,e_2,e_3\}$所对应的矩阵$A$；

            \item 求$\sigma$关于基$\{(1,1,1),(0,1,1),(0,0,1)\}$所对应的矩阵$B$；

            \item 求矩阵$C_1$，使$C_1^{-1}BC_1=A$.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
                \item $A=\begin{pmatrix}
                              2 & -2 & 0 \\ -2 & 1 & -2 \\ 0 & -2 & 0
                          \end{pmatrix}$；

                \item $B=\begin{pmatrix}
                              0 & -2 & 0 \\ -3 & 1 & -2 \\ 1 & -1 & 2
                          \end{pmatrix}$；

                \item 根据讲义本讲开头的定理（线性变换在不同基下的表示），$C_1$实际上就是基$\alpha_1,\alpha_2,\alpha_3$变为自然基$e_1,e_2,e_3$的过渡矩阵，简单计算可得$\begin{pmatrix}
                              1 & 0 & 0 \\ -1 & 1 & 0 \\ 0 & -1 & 1
                          \end{pmatrix}$.
            \end{enumerate}
        \end{answer}

        \item 设$A=\begin{pmatrix}
                0 & 0 & 1 \\ 0 & 0 & 0 \\ 1 & 0 & 0
            \end{pmatrix},B=\begin{pmatrix}
                1 & 0 & 0 \\ 0 & 1 & 2 \\ 0 & -1 & -2
            \end{pmatrix}$，证明：$A\sim B$，并求可逆矩阵$P$使得$P^{-1}AP=B$.
        \begin{answer}
            不难解得$A$和$B$的特征值均为$-1,0,1$，因此它们都与$\begin{pmatrix}
                -1 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 1
            \end{pmatrix}$相似，即$A$与$B$相似. 我们也可以解得$P_1=\begin{pmatrix}
                -1 & 0 & 1 \\ 0 & 1 & 0 \\ 1 & 0 & 1
            \end{pmatrix}$和$P_2=\begin{pmatrix}
                0 & 0 & 1 \\ -1 & -2 & 0 \\ 1 & 1 & 0
            \end{pmatrix}$使得$P_1^{-1}AP_1=P_2^{-1}BP_2=\begin{pmatrix}
                -1 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 1
            \end{pmatrix}$，故$(P_1P_2^{-1})^{-1}A(P_1P_2^{-1})=B$，即题目要求的$P=P_1P_2^{-1}=\begin{pmatrix}
                1 & -1 & -2 \\ 0 & -1 & -1 \\ 1 & 1 & 2
            \end{pmatrix}$.
        \end{answer}

        \item 已知$A=\begin{pmatrix}
                2 & 0 & 0 \\ 0 & 0 & 1 \\ 0 & 1 & x
            \end{pmatrix}$与$B=\begin{pmatrix}
                2 & 0 & 0 \\ 0 & y & 0 \\ 0 & 0 & -1
            \end{pmatrix}$相似.
        \begin{enumerate}
            \item 求$x$和$y$；

            \item 求一个可逆矩阵$P$，使$P^{-1}AP$为对角矩阵.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
                \item $A$与$B$相似则特征值相等，我们知道矩阵的对角线元素之和等于特征值之和，行列式等于特征值之积，则它们也一定相等. 根据这一原理非常容易解得$x=0,y=1$.

                \item 事实上$B$就是对角矩阵，实际上这里就是求过渡矩阵$P$使$A$对角化，具体步骤不再赘述，得到$P=\begin{pmatrix}
                              1 & 0 & 0 \\ 0 & 1 & 1 \\ 0 & 1 & -1
                          \end{pmatrix}$.
            \end{enumerate}
        \end{answer}

        \item 设$A=\begin{pmatrix}
                1 & 2 & 0 & 0  & 0 \\ 4 & 3 & 0 & 0 & 0 \\ 0 & 0 & 1 & -3 & 3 \\ 0 & 0 & 3 & -5 & 3 \\
                0 & 0 & 6 & -6 & 4
            \end{pmatrix}$，求$A$的特征值. 若$A$可对角化，求可逆矩阵$P$，使$P^{-1}AP$为对角矩阵.
        \begin{answer}
            令$A_1=\begin{pmatrix}
                1 & 2 \\ 4 & 3
            \end{pmatrix}$，$A_2=\begin{pmatrix}
                1 & -3 & 3 \\ 3 & -5 & 3 \\ 6 & -6 & 4
            \end{pmatrix}$，则$A=\begin{pmatrix}
                A_1 & O \\ O & A_2
            \end{pmatrix}$. 首先得到$A_1$和$A_2$的特征值分别为$-1,5$和$-2,-2,4$. 分别求过渡矩阵$P_1$和$P_2$使得$A_1$，$A_2$对角化，容易解得$P_1=\begin{pmatrix}
                -1 & 1 \\ 1 & 2
            \end{pmatrix}$，$P_2=\begin{pmatrix}
                1 & 1 & 1 \\ 1 & 0 & 1 \\ 0 & -1 & 2
            \end{pmatrix}$. 令$P=\begin{pmatrix}
                P_1 & O \\ O & P_2
            \end{pmatrix}$，则
        \[P^{-1}AP=\begin{pmatrix}
                P_1^{-1}A_1P_1 & O \\ O & P_2^{-1}A_2P_2
            \end{pmatrix}=\begin{pmatrix}
                -1 & 0 & 0 & 0 & 0 \\ 0 & 5 & 0 & 0 & 0 \\ 0 & 0 & -2 & 0 & 0 \\ 0 & 0 & 0 & -2 & 0 \\ 0 & 0 & 0 & 0 & 4
            \end{pmatrix},\]
        即$P^{-1}AP=\diag(-1,5,-2,-2,4)$，故$A$与$\diag(-1,5,-2,-2,4)$相似. 总之，$A$的特征值为$-1,5,-2,-2,4$，过渡矩阵$P=\begin{pmatrix}
                P_1 & O \\ O & P_2
            \end{pmatrix}=\begin{pmatrix}
                -1 & 1 & 0 & 0 & 0 \\ 1 & 2 & 0 & 0 & 0 \\ 0 & 0 & 1 & 1 & 1 \\ 0 & 0 & 1 & 0 & 1 \\ 0 & 0 & 0 & -1 & 2
            \end{pmatrix}$.

        （注：通过本题也可以看出分块对角矩阵的特征值是两个对角块矩阵的并集，过渡矩阵就是两个过渡矩阵按同样分块方式排列得到的矩阵.）
        \end{answer}

        \item 设三阶矩阵$A$的特征值为$\lambda_1=1,\lambda_2=2,\lambda_3=3$，它们对应的特征向量为$\xi_1=(1,1,1)^\mathrm{T}, \xi_2=(1,2,4)^\mathrm{T},\xi_3=(1,3,9)^\mathrm{T}$，又$\beta=(1,1,3)^\mathrm{T}$，计算$A^n\beta$.
        \begin{answer}
            回顾对角化过程可知，令$P=(\xi_1,\xi_2,\xi_3)=\begin{pmatrix}
                1 & 1 & 1 \\ 1 & 2 & 3 \\ 1 & 4 & 9
            \end{pmatrix}$，则$P^{-1}AP=\begin{pmatrix}
                1 & 0 & 0 \\ 0 & 2 & 0 \\ 0 & 0 & 3
            \end{pmatrix}$，即$P^{-1}A^nP=\begin{pmatrix}
                1 & 0 & 0 \\ 0 & 2^n & 0 \\ 0 & 0 & 3^n
            \end{pmatrix}$，故$A^n=P\begin{pmatrix}
                1 & 0 & 0 \\ 0 & 2^n & 0 \\ 0 & 0 & 3^n
            \end{pmatrix}P^{-1}$，最后可以计算得到$A^n\beta=\begin{pmatrix}
                2-2^{n+1}+3^n \\ 2-2^{n+2}+3^{n+1} \\ 2-2^{n+3}+3^{n+2}
            \end{pmatrix}$.
        \end{answer}

        \item 设$A=\begin{pmatrix}
                3 & 4 & 0 & 0 \\ 4 & -3 & 0 & 0 \\ 0 & 0 & 2 & 4 \\ 0 & 0 & 0 & 2
            \end{pmatrix}$，求$A^n(n\in\mathbf{N}_+)$.
        \begin{answer}
            设$A=\begin{pmatrix}
                A_1 & O \\ O & A_2
            \end{pmatrix}$，其中$A_1=\begin{pmatrix}
                3 & 4 \\ 4 & -3
            \end{pmatrix}$，$A_2=\begin{pmatrix}
                2 & 4 \\ 0 & 2
            \end{pmatrix}$. 回顾矩阵运算进阶中介绍的求幂方法，我们发现$A_2=2E+B$，其中$B=\begin{pmatrix}
                0 & 4 \\ 0 & 0
            \end{pmatrix}$，且$B^2=O$，因此$A_2^n=(2E+B)^n=2^nE+n2^{n-1}B=\begin{pmatrix}
                2^n & n2^{n+1} \\ 0 & 2^n
            \end{pmatrix}$. 再看$A_1$，我们用对角化方法求幂，容易求得$P=\begin{pmatrix}
                2 & -1 \\ 1 & 2
            \end{pmatrix}$使得$P^{-1}A_1P=\begin{pmatrix}
                5 & 0 \\ 0 & -5
            \end{pmatrix}$，故$A_1^n=P\begin{pmatrix}
                5^n & 0 \\ 0 & (-5)^n
            \end{pmatrix}P^{-1}=5^{n-1}\begin{pmatrix}
                4+(-1)^n & 2+2(-1)^{n+1} \\ 2+2(-1)^{n+1} & 1+4(-1)^n
            \end{pmatrix}$，最后结合上面的讨论得到$A^n=\begin{pmatrix}
                A_1^n & O \\ O & A_2^n
            \end{pmatrix}$.
        \end{answer}

        \item 已知三阶矩阵$A$和三元列向量$X$，使得向量组$X,AX,A^2X$线性无关，且满足
        \[A^3X=3AX-2A^2X.\]
        \begin{enumerate}
            \item 记$P=(X,AX,A^2X)$，求三阶矩阵$B$使得$A=PBP^{-1}$；

            \item 计算行列式$|A+E|$.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
              \item 由题意，$PB=AP$，利用分块矩阵乘法可知$PB=AP=(AX,A^2X,A^3X)=(AX,A^2X,3AX-2A^2X)$（注意$(AX,A^2X,A^3X)B=(AXB,A^2XB,A^3XB)$是错误的，因为这是$1\times 3$分块和$1\times 1$分块相乘，显然不能这么乘）.

                    则$PB=(AX,A^2X,3AX-2A^2X)=(X,AX,A^X)\begin{pmatrix}
                            0 & 0 & 0 \\ 1 & 0 & 3 \\ 0 & 1 & -2
                        \end{pmatrix}$. 等号两边左乘$P^{-1}$有$B=\begin{pmatrix}
                            0 & 0 & 0 \\ 1 & 0 & 3 \\ 0 & 1 & -2
                        \end{pmatrix}$.

              \item 由于$A$与$B$相似，故有相同的特征值，易求得$B$的特征值为$0,-3,1$，则$A$的特征值也为$0,-3,1$，则$A+E$的特征值根据正文例题可知为$1,-2,2$，则$A+E$的行列式为其特征值之积，即为$-4$.
          \end{enumerate}
        \end{answer}
    \end{exgroup}

    \begin{exgroup}
        \item 设$V$是有限维复向量空间，$\sigma\in \mathcal{L}(V)$. 证明：$\sigma$可对角化当且仅当对每个$\lambda\in\mathbf{C}$有$V=\ker(\sigma-\lambda I)\oplus\im(\sigma-\lambda I)$.
        \begin{answer}
            暂略，有需要可以参考\href{https://linearalgebras.com/5c.html}{《线性代数应该这样学》作者给出的答案（见网页第五题）}；
        \end{answer}

        \item 设$B=\alpha\alpha^\mathrm{T}$，其中$\alpha=(a_1,\ldots,a_n)^\mathrm{T}\neq 0\enspace(a_i\in\mathbf{R},\enspace i=1,2,\ldots,n)$.
        \begin{enumerate}
            \item 证明：$B^k=tB$，其中$k$为正整数，$t$为常数，并求$t$；

            \item 求可逆阵$P$使得$P^{-1}BP$为对角矩阵，并写出该对角矩阵.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
                \item $B^2=\alpha(\alpha^\mathrm{T}\alpha)\alpha^\mathrm{T}=m\alpha\alpha^\mathrm{T}=mB$，其中$m=\alpha^\mathrm{T}\alpha=a_1^2+\cdot+a_n^2$，且易知这就是$\tr(B)$. 用归纳法可知$B^k=m^{k-1}B$，令$t=m^{k-1}$则得证，其中$t=(\tr(B))^{k-1}$.

                \item 这是经典的秩1矩阵，由于$B$的秩为1，则$BX=0$的解空间维数为$n-1$，因此0是$B$的$n-1$重特征值. 而特征值之和等于矩阵的迹. 则剩下一个一重特征值为$\tr(B)$（由题意迹不为0）.

                      然后求特征向量，这里需要一些观察. 特征值0对应的特征向量即为$BX=0$的解，设解为$(x_1,\ldots,x_n)$，不失一般性地，设$a_1\neq 0$，由于$B$的秩为1，因此将$BX=0$展开为线性方程组后，每一行（除去全0的）代表的方程是完全一致的（因为它们成比例），因此我们只需考虑第一行方程
                      \[a_1^2x_1+a_1a_2x_2+\cdots+a_1a_nx_n=0,\]
                      解得$n-1$个线性无关特征向量为
                      \[X_1=(-a_2,a_1,0,\ldots,0),X_2=(-a_3,0,a_1,0,\ldots,0),\ldots,X_{n-1}=(-a_n,0,\ldots,0,a_1).\]
                      对于特征值$\tr(B)=\alpha^\mathrm{T}\alpha$，我们可以设特征向量为$X$，则$(\tr(B)E-B)X=(\alpha^\mathrm{T}\alpha E-\alpha\alpha^\mathrm{T})X=0$，即$\alpha^\mathrm{T}X=\alpha\alpha^\mathrm{T}X$，我们可以观察发现$\alpha$就是一个解，则$X_n=\alpha$是其特征向量. 则$P=\begin{pmatrix}
                              -a_2 & -a_3 & \cdots & -a_n & a_1 \\ a_1 & 0 & \cdots & 0 & a_2 \\ 0 & a_1 & \cdots & 0 & a_3 \\ \vdots & \vdots & \ddots & \vdots & \vdots \\ 0 & 0 & \cdots & a_1 & a_n
                          \end{pmatrix}$，且对角矩阵为$\diag(0,\ldots,0,\alpha^\mathrm{T}\alpha)$.
            \end{enumerate}
        \end{answer}

        \item （秩为1的矩阵）设$n$阶矩阵$A$的元素均为1.
        \begin{enumerate}
            \item 求$A$的特征值，并求矩阵$P$使得$P^{-1}AP$为对角矩阵；

            \item 若$f(x)$是$x$的$m$次多项式，且常数项为0，证明：存在$k\in\mathbf{R}$使得$f(A)=kA$，并求出$k$；

            \item 设$B$是$n$阶实对称矩阵，每行元素之和都为$b$，若$b$是$f(\lambda)=|\lambda E-B|$的单根，求$B$属于$b$的特征向量；当$f(\lambda)=(\lambda-b)g(\lambda)$时（其中$f(B)=0$），证明：$g(B)=kA$，其中$k$为常数，$A$为元素全部为1的$n$阶矩阵.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
                \item 由题意知$A$的秩为1，因此特征值0对应的特征子空间为$AX=0$的解空间，维数为$n-1$，故特征值0的重数至少为$n-1$. 剩下可能还有一个特征值，我们知道特征值之和等于对角线元素之和，因此最后一个特征值等于$n$，$n$对应的特征子空间维数至少为1，结合0对应特征子空间维数为$n-1$可知$n$对应的特征子空间维数就是1，二者可以张成整个$\mathbf{R}^n$，因此可以对角化.

                      下面求过渡矩阵，$n$对应的特征向量只需解方程$(nE-A)X=0$，即得$X_1=(1,1,\ldots,1)^\mathrm{T}$. 0对应的$n-1$个线性无关特征向量就是$AX=0$的基础解系，即$X_2=(-1,1,0,\ldots,0)^\mathrm{T},X_3=(-1,0,1,0,\ldots,0)^\mathrm{T},\ldots,X_n=(-1,0,\ldots,0,1)^\mathrm{T}$，令$P=(X_1,X_2,\ldots,X_n)=\begin{pmatrix}
                              1 & -1 & -1 & \cdots & -1 \\ 1 & 1 & 0 & \cdots & 0 \\ 1 & 0 & 1 & \cdots & 0 \\ \vdots & \vdots & \vdots & \ddots & \vdots \\ 1 & 0 & 0 & \cdots & 1
                          \end{pmatrix}$，则有$P^{-1}AP=\varLambda=\diag(n,0,\ldots,0)$.

                \item 由上一小问可知$A=P\varLambda P^{-1}$，则$A^k=P\varLambda^kP^{-1}$，故
                      \[A^k=P\varLambda^kP^{-1}=P\diag(n^k,0,\ldots,0)P^{-1},\]
                      故
                      \begin{align*}
                          f(A) & =a_mA^m+a_{m-1}A^{m-1}+\cdots+a_1A                                                                                                   \\
                               & =P(a_m\varLambda^m+a_{m-1}\varLambda^{m-1}+\cdots+a_1\varLambda)P^{-1}                                                               \\
                               & =P\begin{pmatrix}
                                       a_mn^m+a_{m-1}n^{m-1}+\cdots+a_1n & 0 & \cdots & 0 \\ 0 & 0 & \cdots & 0 \\ \vdots & \vdots & \ddots & \vdots \\ 0 & 0 & \cdots & 0
                                   \end{pmatrix}P^{-1} \\
                               & =\begin{pmatrix}
                                      f(n) & 0 & \cdots & 0 \\ 0 & 0 & \cdots & 0 \\ \vdots & \vdots & \ddots & \vdots \\ 0 & 0 & \cdots & 0
                                  \end{pmatrix}=\dfrac{f(n)}{n}P\begin{pmatrix}
                                                                    n & 0 & \cdots & 0 \\ 0 & 0 & \cdots & 0 \\ \vdots & \vdots & \ddots & \vdots \\ 0 & 0 & \cdots & 0
                                                                \end{pmatrix}P^{-1}    \\
                               & =\dfrac{f(n)}{n}P\varLambda P^{-1}=kA.
                      \end{align*}
                      其中$k=\dfrac{f(n)}{n}$. 故$f(A)=kA$.

                \item 显然$X=(1,1,x\cdots,1)^\mathrm{T}$是$B$关于特征值$b$的特征向量，由于$b$是特征多项式的单根，则特征子空间维数也为1，故特征向量就是$kX$（其中$k$为非零常数）.

                      又$f(B)=(B-bE)g(B)=O$，则$Bg(B)=bg(B)$. 令$g(B)$的列向量组为$\alpha_1,\ldots,\alpha_n$，则上式可以写为$B(\alpha_1,\ldots,\alpha_n)=(b\alpha_1,\ldots,b\alpha_n)$，即$B\alpha_i=b\alpha_i$，即$\alpha_i$是$B$关于特征值$b$的特征向量，故$\alpha_i=k_iX=(k_i,k_i,\ldots,k_i)^{\mathrm{T}}$，即$g(B)=\begin{pmatrix}
                              k_1 & k_2 & \cdots & k_n \\ k_1 & k_2 & \cdots & k_n \\ \vdots & \vdots & \ddots & \vdots \\ k_1 & k_2 & \cdots & k_n
                          \end{pmatrix}$. 由于$B$是实对称矩阵，故$g(B)$也是实对称矩阵（很容易验证实对称矩阵经过幂次、加法运算后仍是实对称矩阵），因此$g(B)=(g(B))^\mathrm{T}$，故$k_1=k_2=\cdots=k_n=k$，即$g(B)=kA$.
            \end{enumerate}
        \end{answer}

        \item 设$A,B$为$n$阶矩阵，且$A+B=AB$，求证：
        \begin{enumerate}
            \item $A,B$的特征向量是公共的；

            \item $A$相似于对角矩阵当且仅当$B$相似于对角矩阵；

            \item $r(A)=r(B)$.
        \end{enumerate}
        \begin{answer}
            \begin{enumerate}
                \item 设$\alpha$是$B$的特征向量，对应的特征值为$\lambda$，即$B\alpha=\lambda\alpha$，则$A\alpha+B\alpha-AB\alpha=0$，即$A\alpha+\lambda\alpha-A\lambda\alpha=0$，即$(1-\lambda)A\alpha=-\lambda\alpha$. 若$\lambda=1$，则$\alpha=0$，与它是特征向量矛盾，故$\lambda\neq 1$，从而$A\alpha=\dfrac{-\lambda}{1-\lambda}\alpha$，这就说明了$B$的特征向量就是$A$的特征向量.

                      由$A+B=AB$可知，$(A-E)(B-E)=E$，故$A-E$可逆，且$(A-E)^{-1}=B-E$，从而$E=(B-E)(A-E)=BA-A-B+E$，故$BA=A+B$，同上理可得$A$的特征向量也是$B$的，得证.

                \item \begin{enumerate}
                          \item 必要性：若$A$可对角化，则$\mathbf{R}^n$有一组由$A$的特征向量张成的基，由（1）知$B$与$A$特征向量一致，故$\mathbf{R}^n$也有一组由$B$的特征向量张成的基，即$B$可对角化.

                          \item 充分性与必要性类似.
                      \end{enumerate}

                \item 由$A+B=AB$可知$A=(A-E)B$且$B=A(B-E)$，由此可得$r(A)\leqslant r(B)\leqslant r(A)$，故$r(A)=r(B)$.
            \end{enumerate}
        \end{answer}

        \item 设$A,B\in \mathbf{M}_n(\mathbf{R})$，证明$A$与$B$在$\mathbf{R}$上相似当且仅当在$\mathbf{C}$上相似.

        {\kaishu 注：实际上相似这一性质与数域无关，本题是这一结论的特例.}
        \begin{answer}
            \begin{enumerate}
                \item 必要性：$A$和$B$在实数域上相似，则存在可逆实矩阵$C$使得$B=C^{-1}AC$，将$A,B,C$视为复数域上的矩阵，则可知$A$和$B$在复数域上也相似.

                \item 充分性：若$A$和$B$在复数域上相似，则存在可逆复矩阵$P=P_1+\i P_2$使得$B=P^{-1}AP$，其中$P_1,P_2$是实矩阵，即$AP=PB$，从而$A(P_1+\i P_2)=(P_1+\i P_2)B$，比较实部虚部可知$AP_1=P_1B$且$AP_2=P_2B$. 构造实系数多项式$f(t)=|P_1+tP_2|$，显然$f(\i)=|P|\neq 0$，则$f(t)$是非零多项式，所以$f(t)$的根只有有限多个，从而存在$t_0\in\mathbf{R}$使得$f(t_0)\neq 0$，则$|P_1+t_0P_2|\neq 0$，从而$P_1+t_0P_2$可逆，从而$A(P_1+t_0P_2)=AP_1+t_0AP_2=P_1B+t_0P_2B=(P_1+t_0P_2)B$，即$(P_1+t_0P_2)^{-1}A(P_1+t_0P_2)=B$，即$A$和$B$在实数域上相似.
            \end{enumerate}
        \end{answer}

        \item \begin{enumerate}
            \item 设$A,B\in \mathbf{M}_n(\mathbf{F})$，$A$有$n$个不同的特征值，证明：$AB=BA$当且仅当$A$的特征向量也是$B$的特征向量；

            \item 若$A,B$均可对角化，且$AB=BA$，则对角化的过渡矩阵可以相同.
        \end{enumerate}
        \begin{answer} \label{ex:交换对角化}
            \begin{enumerate}
                \item \begin{enumerate}
                          \item 必要性：$A$有$n$个互不相等的特征值，则$A$一定可对角化，则$A$有$n$个线性无关特征向量，记为$X_1,\ldots,X_n$，则$AX_i=\lambda_iX_i\enspace (X_i\neq 0)$，则$A(BX_i)=B(AX_i)=\lambda_i(BX_i)$，即$BX_i$属于$A$的特征子空间$V_{\lambda_i}$，又$\lambda_i$是$A$的单重特征值，对应的特征子空间是一维的，故$V_{\lambda_i}$中任两个向量成比例，即$BX_i=\mu_iX_i$，故$X_i$也是$B$关于特征值$\mu_i$的特征向量.

                          \item 充分性：必要性：$A$有$n$个互不相等的特征值，则$A$一定可对角化，则$A$有$n$个线性无关特征向量$X_1,\ldots,X_n$，由于它们也是$B$的特征向量，故$B$可对角化. 设$P=(X_1,\ldots,X_n)$，则$P^{-1}AP=\varLambda_1$，$P^{-1}BP=\varLambda_2$，其中$\varLambda_1$和$\varLambda_2$都是对角矩阵，则它们乘法可交换，即$(P^{-1}AP)(P^{-1}BP)=\varLambda_1\varLambda_2=\varLambda_2\varLambda_1=(P^{-1}BP)(P^{-1}AP)$，上式两边左乘$P$，右乘$P^{-1}$，则$AB=BA$.
                      \end{enumerate}

                \item 由于$A$可对角化，所以存在可逆矩阵$P$使得$P^{-1}AP=\diag(\lambda_1E_1,\ldots,\lambda_sE_s)$，其中$\lambda_1,\ldots,\lambda_s$是$A$的所有互异特征值，$E_1,\ldots,E_s$分别是$r_2,\ldots,r_s$阶单位矩阵，且$r_1+\cdots+r_s=n$，由$AB=BA$可知$P^{-1}APP^{-1}BP=P^{-1}BPP^{-1}AP$，根据正文矩阵运算进阶中对矩阵乘法可交换问题的讨论中准对角矩阵的结论，我们有$P^{-1}BP=\diag(B_1,\ldots,B_s)$，其中$B_i$是$r_i$阶矩阵. 由于$B$可对角化，因此$P^{-1}BP$也可对角化（因为它和$B$相似，故它们有相同的相似标准形），从而$B_1,\ldots,B_s$都可对角化，故对于任意的$B_i(i=1,2,\ldots,s)$，存在可逆矩阵$Q_i$使得$Q_i^{-1}B_iQ_i$是对角矩阵. 取$Q=\diag(Q_1,\ldots,Q_s)$，则$Q^{-1}P^{-1}BPQ=\diag(Q_1^{-1}B_1Q_1,\ldots,Q_s^{-1}B_sQ_s)$是对角矩阵，同时有
                      \[Q^{-1}P^{-1}APQ=\diag(\lambda_1E_1,\ldots,\lambda_sE_s),\]
                      则$Q^{-1}P^{-1}APQ=\diag(\lambda_1Q_1^{-1}Q_1,\ldots,\lambda_sQ_s^{-1}Q_s)=\diag(\lambda_1E_1,\ldots,\lambda_sE_s)$为对角矩阵，因此取$T=PQ$就有$T^{-1}AT$和$T^{-1}BT$都是对角矩阵.
            \end{enumerate}
        \end{answer}

        \item 设$A,B\in \mathbf{M}_n(\mathbf{F})$，$A$有$n$个不同的特征值，且$AB=BA$. 证明：存在次数小于等于$n-1$的多项式$f(x)$使得$B=f(A)$.
        \begin{answer}
            此题条件与C组 \ref*{ex:交换对角化} 题相同，因此我们知道存在可逆矩阵$P$使得$P^{-1}AP$和$P^{-1}BP$都是对角矩阵（因为$A$的$n$个线性无关特征向量也是$B$的线性无关特征向量）. 设$P^{-1}AP=\diag(\lambda_1,\ldots,\lambda_n)$，$P^{-1}BP=\diag(\mu_1,\ldots,\mu_n)$，并设$f(x)=a_{n-1}x^{n-1}+\cdots+a_1x+a_0$满足$f(A)=B$，则$a_{n-1}A^{n-1}+\cdots+a_1A+a_0E=B$，从而
          \[a_{n-1}(P^{-1}AP)^{n-1}+\cdots+a_1(P^{-1}AP)+a_0E=P^{-1}BP,\]
          即
          \[\begin{cases} \begin{aligned}
                      a_{n-1}\lambda_1^{n-1}+\cdots+a_1\lambda_1+a_0 & = \mu_1           \\
                      a_{n-1}\lambda_2^{n-1}+\cdots+a_1\lambda_2+a_0 & = \mu_2           \\
                                                                     & \vdotswithin{ = } \\
                      a_{n-1}\lambda_n^{n-1}+\cdots+a_1\lambda_n+a_0 & = \mu_n
                  \end{aligned} \end{cases}\]
          由于$\lambda_1,\ldots,\lambda_n$两两不同，故上述方程组有唯一解（回忆范德蒙行列式和Cramer法则），从而$a_0,\ldots,a_{n-1}$有唯一解，得证.
        \end{answer}

        \item 设$T\in \mathcal{L}(V)$，$\lambda\in\mathbf{F}$. 证明：对$V$的每个使得$T$有上三角矩阵的基，$\lambda$出现在$T$的矩阵的对角线上的次数等于$\lambda$作为$T$的特征值的重数.
        \begin{answer}
            设$T$在这样的基下的矩阵为上三角矩阵$A$，则$T$的特征多项式$f(\lambda)=|\lambda E-A|=(\lambda-\lambda_1)^{r_1}\cdots(\lambda-\lambda_m)^{r_m}$，其中$r_i$是特征值$\lambda_i$在矩阵对角线上出现的次数，而$f(\lambda)=(\lambda-\lambda_1)^{\dim E(\lambda_1,T)}\cdots(\lambda-\lambda_m)^{\dim E(\lambda_m,T)}$，因此有$r_i=\dim E(\lambda_i,T)$.
            即$\lambda$出现在$T$的矩阵的对角线上的次数等于$\lambda$作为$T$的特征值的重数.
        \end{answer}

        \item 证明：$A$为幂零矩阵$\iff \forall k \in \mathbf{N}_+,\enspace\tr(A^k)=0$.
        \begin{answer}
            $A$为幂零矩阵$\iff A$的所有特征值均为0.

            设$A=P^{-1}BP$,其中$B$为上三角矩阵，设$B$对角线上元素为$\lambda_1,\lambda_2,\ldots,\lambda_n$，则对$\forall k\in \mathbf{N}_+$，$B^k$为上三角矩阵且对角线上为$\lambda_1^k,\lambda_2^k,\ldots,\lambda_n^k$.

            这表明$A$是幂零矩阵$\iff B$只有特征值$0\iff \forall k\in\mathbf{N}_+,B^k$特征值全为$0\iff \forall k\in\mathbf{N}_+,A^k$特征值全为$0\iff \forall k\in\mathbf{N}_+,\tr(A^k)=0$.
        \end{answer}
    \end{exgroup}
\end{exercise}
